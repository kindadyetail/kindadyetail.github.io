<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management | Kindady's E-tail</title>
 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    
    
        <!-- FAVICON CONFIGURATION -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ed64a6">
    <meta name="msapplication-TileColor" content="#1a365d">
    <meta name="theme-color" content="#ffffff">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #f8fafc;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
    
        .dashboard-title {
            text-align: center;
            margin: 40px 0 30px;
            color: #1a365d;
        }
        
        .dashboard-title h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .dashboard-title p {
            color: #666;
            font-size: 16px;
        }
        
        /* Stock Stats */
        .stock-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .stat-icon.in-stock {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .stat-icon.low-stock {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .stat-icon.out-of-stock {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .stat-icon.total {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-info h3 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: #666;
            font-size: 14px;
        }
        
        /* Stock Filters */
        .stock-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-btn.active {
            background: #1a365d;
            color: white;
            border-color: #1a365d;
        }
        
        .filter-btn:hover:not(.active) {
            border-color: #cbd5e0;
            background: #f7fafc;
        }
        
        /* Products Grid */
        .products-management-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .product-management-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .product-management-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .product-image-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            position: relative;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-management-card:hover .product-image {
            transform: scale(1.05);
        }
        
        .product-details {
            padding: 20px;
            flex-grow: 1;
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .product-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #2d3748;
            line-height: 1.4;
        }
        
        .product-price {
            color: #ed64a6;
            font-size: 18px;
            font-weight: 700;
        }
        
        .product-category {
            display: inline-block;
            background: #e2e8f0;
            color: #4a5568;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        /* Stock Management Section */
        .stock-management {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .stock-management h4 {
            margin-bottom: 15px;
            color: #1a365d;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stock-status-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .status-option {
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .status-radio {
            display: none;
        }
        
        .status-label {
            display: block;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .status-radio:checked + .status-label {
            border-color: #1a365d;
            background: #1a365d;
            color: white;
        }
        
        .status-label.in-stock {
            border-left: 4px solid #10b981;
        }
        
        .status-label.low-stock {
            border-left: 4px solid #f59e0b;
        }
        
        .status-label.out-of-stock {
            border-left: 4px solid #ef4444;
        }
        
        .quantity-input {
            margin-top: 15px;
        }
        
        .quantity-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }
        
        .quantity-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .quantity-input-group input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }
        
        .quantity-input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .update-stock-btn {
            width: 100%;
            padding: 12px;
            background: #1a365d;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .update-stock-btn:hover {
            background: #2d3748;
            transform: translateY(-2px);
        }
        
        /* Quick Actions */
        .quick-actions {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .quick-actions h3 {
            margin-bottom: 20px;
            color: #1a365d;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 24px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background: #1a365d;
            color: white;
            border-color: #1a365d;
        }
        
        .action-btn.danger {
            border-color: #fee2e2;
            color: #dc2626;
        }
        
        .action-btn.danger:hover {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            grid-column: 1 / -1;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ed64a6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* No Products */
        .no-products {
            text-align: center;
            padding: 60px 20px;
            grid-column: 1 / -1;
        }
        
        .no-products i {
            font-size: 64px;
            color: #d1d5db;
            margin-bottom: 20px;
        }
        
        .no-products h3 {
            margin-bottom: 10px;
            color: #4b5563;
        }
        
        .no-products p {
            color: #6b7280;
            margin-bottom: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-management-grid {
                grid-template-columns: 1fr;
            }
            
            .stock-stats {
                grid-template-columns: 1fr;
            }
            
            .status-option {
                min-width: 100px;
            }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: none;
            max-width: 350px;
        }
        
        .notification.show {
            display: block;
        }
        
        .notification.success {
            background: #10b981;
            color: white;
        }
        
        .notification.error {
            background: #ef4444;
            color: white;
        }
        
        .notification.warning {
            background: #f59e0b;
            color: white;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        /* Minimal Navigation Links */
.nav-links {
    display: flex;
    gap: 15px;
}

.nav-links a {
    color: #4a5568;
    text-decoration: none;
    font-size: 14px;
    padding: 8px 0;
    position: relative;
    transition: color 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.nav-links a:hover {
    color: #ed64a6;
}

.nav-links a.active {
    color: #ed64a6;
    font-weight: 600;
}

.nav-links a.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: #ed64a6;
    border-radius: 2px;
}
    </style>
       <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Header -->
<!-- Header -->
<header class="header">
    <div class="header-content">
        <!-- Non-clickable logo (same structure as first example) -->
        <div class="logo-words">
            <span class="logo-main">KINDADY'S</span>
            <span class="logo-tagline">E-tail with Heart</span>
        </div>
        
        <nav class="nav-links">
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="seller.html"><i class="fas fa-cloud-upload-alt"></i> Upload Products</a>
            <a href="stock-management.html" class="active"><i class="fas fa-boxes"></i> Stock Management</a>
        </nav>
    </div>
</header>

    <!-- Dashboard -->
    <div class="container">
        <div class="dashboard-title">
            <h1><i class="fas fa-boxes"></i> Stock Management</h1>
            <p>Manage product inventory and stock levels</p>
        </div>

        <!-- Stock Statistics -->
        <div class="stock-stats">
            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-box"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalProducts">0</h3>
                    <p>Total Products</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon in-stock">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="inStockProducts">0</h3>
                    <p>In Stock</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon low-stock">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="lowStockProducts">0</h3>
                    <p>Low Stock</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon out-of-stock">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="outOfStockProducts">0</h3>
                    <p>Out of Stock</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            <div class="action-buttons">
                <button class="action-btn" onclick="filterProducts('all')">
                    <i class="fas fa-list"></i> Show All Products
                </button>
                <button class="action-btn" onclick="filterProducts('in-stock')">
                    <i class="fas fa-check-circle"></i> Show In Stock Only
                </button>
                <button class="action-btn" onclick="filterProducts('out-of-stock')">
                    <i class="fas fa-times-circle"></i> Show Out of Stock
                </button>
                <button class="action-btn" onclick="filterProducts('low-stock')">
                    <i class="fas fa-exclamation-triangle"></i> Show Low Stock
                </button>
                <button class="action-btn danger" onclick="bulkUpdateStock('in-stock')">
                    <i class="fas fa-sync-alt"></i> Restock All Products
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="stock-filters">
            <button class="filter-btn active" data-filter="all" onclick="filterProducts('all')">
                <i class="fas fa-list"></i> All Products
            </button>
            <button class="filter-btn" data-filter="clothing" onclick="filterByCategory('clothing')">
                <i class="fas fa-tshirt"></i> Clothing
            </button>
            <button class="filter-btn" data-filter="fragrance" onclick="filterByCategory('fragrance')">
                <i class="fas fa-spray-can"></i> Fragrances
            </button>
            <button class="filter-btn" data-filter="footwear" onclick="filterByCategory('footwear')">
                <i class="fas fa-shoe-prints"></i> Footwear
            </button>
            <button class="filter-btn" data-filter="accessories" onclick="filterByCategory('accessories')">
                <i class="fas fa-gem"></i> Accessories
            </button>
        </div>

        <!-- Products Grid -->
        <div class="products-management-grid" id="productsGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading products...</p>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDfpoqyjtO7VueYtcGEYTfkWHOl4YNG7sk",
            authDomain: "kindadys-9924e.firebaseapp.com",
            projectId: "kindadys-9924e",
            storageBucket: "kindadys-9924e.firebasestorage.app",
            messagingSenderId: "772017587580",
            appId: "1:772017587580:web:82cd5c27edf6bfc44c50f9",
            measurementId: "G-D74KTPX92D"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Global variables
        let allProducts = [];
        let currentFilter = 'all';
        let currentCategory = 'all';

        // Load products from Firebase
        async function loadProducts() {
            const container = document.getElementById('productsGrid');
            
            try {
                container.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading products...</p>
                    </div>
                `;

                const productsCollection = collection(db, 'products');
                const q = query(productsCollection, orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);
                
                allProducts = [];
                querySnapshot.forEach((doc) => {
                    const productData = doc.data();
                    const product = {
                        id: doc.id,
                        ...productData,
                        stock: productData.stock || 0,
                        category: productData.category || 'clothing'
                    };
                    allProducts.push(product);
                });

                console.log(`Loaded ${allProducts.length} products`);
                
                if (allProducts.length === 0) {
                    showNoProducts();
                    updateStats();
                    return;
                }
                
                updateStats();
                displayProducts(allProducts);
                
            } catch (error) {
                console.error('Error loading products:', error);
                showError('Failed to load products. Please try again.');
            }
        }

        // Update statistics
        function updateStats() {
            const totalProducts = allProducts.length;
            const inStockProducts = allProducts.filter(p => (p.stock || 0) > 10).length;
            const lowStockProducts = allProducts.filter(p => (p.stock || 0) > 0 && (p.stock || 0) <= 10).length;
            const outOfStockProducts = allProducts.filter(p => (p.stock || 0) === 0).length;
            
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('inStockProducts').textContent = inStockProducts;
            document.getElementById('lowStockProducts').textContent = lowStockProducts;
            document.getElementById('outOfStockProducts').textContent = outOfStockProducts;
        }

        // Display products
        function displayProducts(products) {
            const container = document.getElementById('productsGrid');
            
            if (products.length === 0) {
                showNoProducts();
                return;
            }
            
            const productsHTML = products.map(product => {
                const stock = product.stock || 0;
                const stockStatus = getStockStatus(stock);
                const imageUrl = product.mainImage || product.images?.[0]?.url || product.url || '';
                const displayImageUrl = imageUrl.includes('res.cloudinary.com') 
                    ? imageUrl.replace('/upload/', '/upload/w_400,h_400,c_fill/')
                    : imageUrl;
                
                return `
                    <div class="product-management-card" data-category="${product.category}" data-stock="${stock}">
                        <div class="product-image-container">
                            <img src="${displayImageUrl || 'https://via.placeholder.com/400x400/cccccc/ffffff?text=Product+Image'}" 
                                 alt="${product.name}" 
                                 class="product-image"
                                 onerror="this.src='https://via.placeholder.com/400x400/cccccc/ffffff?text=Image+Not+Available'}">
                        </div>
                        <div class="product-details">
                            <div class="product-header">
                                <h3 class="product-title">${product.name || 'Untitled Product'}</h3>
                                <span class="product-price">GHS â‚µ${(product.price || 0).toFixed(2)}</span>
                            </div>
                            <span class="product-category">${(product.category || 'clothing').charAt(0).toUpperCase() + (product.category || 'clothing').slice(1)}</span>
                            
                            <div class="stock-management">
                                <h4><i class="fas fa-boxes"></i> Stock Management</h4>
                                
                                <div class="stock-status-selector">
                                    <div class="status-option">
                                        <input type="radio" 
                                               id="in-stock-${product.id}" 
                                               name="status-${product.id}" 
                                               value="in-stock" 
                                               class="status-radio"
                                               ${stock > 10 ? 'checked' : ''}
                                               onchange="updateProductStock('${product.id}', 'in-stock')">
                                        <label for="in-stock-${product.id}" class="status-label in-stock">
                                            <i class="fas fa-check-circle"></i> In Stock
                                        </label>
                                    </div>
                                    
                                    <div class="status-option">
                                        <input type="radio" 
                                               id="low-stock-${product.id}" 
                                               name="status-${product.id}" 
                                               value="low-stock" 
                                               class="status-radio"
                                               ${stock > 0 && stock <= 10 ? 'checked' : ''}
                                               onchange="updateProductStock('${product.id}', 'low-stock')">
                                        <label for="low-stock-${product.id}" class="status-label low-stock">
                                            <i class="fas fa-exclamation-triangle"></i> Low Stock
                                        </label>
                                    </div>
                                    
                                    <div class="status-option">
                                        <input type="radio" 
                                               id="out-of-stock-${product.id}" 
                                               name="status-${product.id}" 
                                               value="out-of-stock" 
                                               class="status-radio"
                                               ${stock === 0 ? 'checked' : ''}
                                               onchange="updateProductStock('${product.id}', 'out-of-stock')">
                                        <label for="out-of-stock-${product.id}" class="status-label out-of-stock">
                                            <i class="fas fa-times-circle"></i> Out of Stock
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="quantity-input">
                                    <label><i class="fas fa-hashtag"></i> Quantity Available</label>
                                    <div class="quantity-input-group">
                                        <input type="number" 
                                               id="quantity-${product.id}" 
                                               value="${stock}"
                                               min="0"
                                               onchange="updateStockQuantity('${product.id}', this.value)">
                                        <button class="update-stock-btn" onclick="saveStockQuantity('${product.id}')">
                                            <i class="fas fa-save"></i> Update Quantity
                                        </button>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 10px; padding: 10px; background: ${stockStatus.color}20; border-radius: 6px; border-left: 3px solid ${stockStatus.color};">
                                    <small style="color: ${stockStatus.color}; font-weight: 500;">
                                        <i class="fas ${stockStatus.icon}"></i> 
                                        ${stockStatus.text}
                                        ${stock > 0 ? `(${stock} units available)` : ''}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = productsHTML;
        }

        // Get stock status
        function getStockStatus(stock) {
            if (stock === 0) {
                return {
                    color: '#ef4444',
                    icon: 'fa-times-circle',
                    text: 'Out of Stock'
                };
            } else if (stock <= 10) {
                return {
                    color: '#f59e0b',
                    icon: 'fa-exclamation-triangle',
                    text: 'Low Stock'
                };
            } else {
                return {
                    color: '#10b981',
                    icon: 'fa-check-circle',
                    text: 'In Stock'
                };
            }
        }

        // Update product stock status
        async function updateProductStock(productId, status) {
            try {
                let stockValue;
                switch(status) {
                    case 'in-stock':
                        stockValue = 50; // Default quantity for in-stock
                        break;
                    case 'low-stock':
                        stockValue = 5; // Default quantity for low stock
                        break;
                    case 'out-of-stock':
                        stockValue = 0;
                        break;
                }
                
                const productRef = doc(db, 'products', productId);
                await updateDoc(productRef, {
                    stock: stockValue,
                    updatedAt: new Date().toISOString()
                });
                
                // Update local data
                const productIndex = allProducts.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    allProducts[productIndex].stock = stockValue;
                }
                
                // Update input field
                const quantityInput = document.getElementById(`quantity-${productId}`);
                if (quantityInput) {
                    quantityInput.value = stockValue;
                }
                
                updateStats();
                filterProducts(currentFilter);
                
                showNotification(`Stock updated to ${status.replace('-', ' ')}`, 'success');
                
                // Update homepage stock indicators
                updateHomepageStock(productId, stockValue);
                
            } catch (error) {
                console.error('Error updating stock:', error);
                showNotification('Failed to update stock', 'error');
            }
        }

        // Update stock quantity
        function updateStockQuantity(productId, quantity) {
            const qty = parseInt(quantity);
            if (isNaN(qty) || qty < 0) {
                showNotification('Please enter a valid quantity', 'warning');
                return;
            }
            
            // Update local data immediately for better UX
            const productIndex = allProducts.findIndex(p => p.id === productId);
            if (productIndex !== -1) {
                allProducts[productIndex].stock = qty;
            }
            
            // Update radio button selection
            updateRadioSelection(productId, qty);
            updateStats();
            
            showNotification(`Quantity updated to ${qty} (click Save to confirm)`, 'info');
        }

        // Save stock quantity to Firebase
        async function saveStockQuantity(productId) {
            const quantityInput = document.getElementById(`quantity-${productId}`);
            const qty = parseInt(quantityInput.value);
            
            if (isNaN(qty) || qty < 0) {
                showNotification('Please enter a valid quantity', 'warning');
                return;
            }
            
            try {
                const productRef = doc(db, 'products', productId);
                await updateDoc(productRef, {
                    stock: qty,
                    updatedAt: new Date().toISOString()
                });
                
                // Update local data
                const productIndex = allProducts.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    allProducts[productIndex].stock = qty;
                }
                
                updateStats();
                filterProducts(currentFilter);
                
                showNotification(`Stock quantity saved: ${qty} units`, 'success');
                
                // Update homepage stock indicators
                updateHomepageStock(productId, qty);
                
            } catch (error) {
                console.error('Error saving quantity:', error);
                showNotification('Failed to save quantity', 'error');
            }
        }

        // Update radio button selection based on quantity
        function updateRadioSelection(productId, quantity) {
            const inStockRadio = document.getElementById(`in-stock-${productId}`);
            const lowStockRadio = document.getElementById(`low-stock-${productId}`);
            const outStockRadio = document.getElementById(`out-of-stock-${productId}`);
            
            if (quantity === 0) {
                if (outStockRadio) outStockRadio.checked = true;
            } else if (quantity <= 10) {
                if (lowStockRadio) lowStockRadio.checked = true;
            } else {
                if (inStockRadio) inStockRadio.checked = true;
            }
        }

        // Filter products by stock status
        function filterProducts(status) {
            currentFilter = status;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            let filteredProducts = allProducts;
            
            if (status === 'in-stock') {
                filteredProducts = allProducts.filter(p => (p.stock || 0) > 10);
            } else if (status === 'low-stock') {
                filteredProducts = allProducts.filter(p => (p.stock || 0) > 0 && (p.stock || 0) <= 10);
            } else if (status === 'out-of-stock') {
                filteredProducts = allProducts.filter(p => (p.stock || 0) === 0);
            }
            
            // Apply category filter if active
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
            }
            
            displayProducts(filteredProducts);
        }

        // Filter by category
        function filterByCategory(category) {
            currentCategory = category;
            
            // Update category filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.getAttribute('data-filter') === category) {
                    btn.classList.add('active');
                } else if (!btn.getAttribute('data-filter')) {
                    btn.classList.remove('active');
                }
            });
            
            let filteredProducts = allProducts;
            
            if (category !== 'all') {
                filteredProducts = allProducts.filter(p => p.category === category);
            }
            
            // Apply stock filter if active
            if (currentFilter !== 'all') {
                if (currentFilter === 'in-stock') {
                    filteredProducts = filteredProducts.filter(p => (p.stock || 0) > 10);
                } else if (currentFilter === 'low-stock') {
                    filteredProducts = filteredProducts.filter(p => (p.stock || 0) > 0 && (p.stock || 0) <= 10);
                } else if (currentFilter === 'out-of-stock') {
                    filteredProducts = filteredProducts.filter(p => (p.stock || 0) === 0);
                }
            }
            
            displayProducts(filteredProducts);
        }

        // Bulk update stock
        async function bulkUpdateStock(status) {
            if (!confirm(`Are you sure you want to set ALL products to "${status.replace('-', ' ')}"?`)) {
                return;
            }
            
            try {
                let stockValue;
                switch(status) {
                    case 'in-stock':
                        stockValue = 50;
                        break;
                    case 'low-stock':
                        stockValue = 5;
                        break;
                    case 'out-of-stock':
                        stockValue = 0;
                        break;
                }
                
                // Update all products in Firebase
                for (const product of allProducts) {
                    const productRef = doc(db, 'products', product.id);
                    await updateDoc(productRef, {
                        stock: stockValue,
                        updatedAt: new Date().toISOString()
                    });
                    
                    // Update local data
                    product.stock = stockValue;
                }
                
                updateStats();
                displayProducts(allProducts);
                
                showNotification(`All products updated to ${status.replace('-', ' ')}`, 'success');
                
            } catch (error) {
                console.error('Error in bulk update:', error);
                showNotification('Failed to update all products', 'error');
            }
        }

        // Update homepage stock indicators
        function updateHomepageStock(productId, stock) {
            // Store update flag in localStorage for homepage to refresh
            localStorage.setItem('stock_updated', 'true');
            localStorage.setItem('last_stock_update', new Date().toISOString());
            
            // Broadcast to other tabs
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('stock_updates');
                channel.postMessage({
                    type: 'stock_updated',
                    productId: productId,
                    stock: stock,
                    timestamp: new Date().toISOString()
                });
            }
        }

        // Show no products message
        function showNoProducts() {
            const container = document.getElementById('productsGrid');
            container.innerHTML = `
                <div class="no-products">
                    <i class="fas fa-box-open"></i>
                    <h3>No Products Found</h3>
                    <p>Upload products first to manage stock</p>
                    <button class="action-btn" onclick="window.location.href='seller.html'">
                        <i class="fas fa-cloud-upload-alt"></i> Go to Upload Products
                    </button>
                </div>
            `;
        }

        // Show error message
        function showError(message) {
            const container = document.getElementById('productsGrid');
            container.innerHTML = `
                <div class="no-products">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Error Loading Products</h3>
                    <p>${message}</p>
                    <button class="action-btn" onclick="loadProducts()">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                </div>
            `;
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Logout function
        document.getElementById('logoutBtn')?.addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                // Clear any admin session data
                localStorage.removeItem('admin_logged_in');
                window.location.href = 'index.html';
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            
            // Listen for stock updates from other tabs
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('stock_updates');
                channel.addEventListener('message', (event) => {
                    if (event.data.type === 'stock_updated') {
                        // Refresh products when stock is updated in another tab
                        loadProducts();
                    }
                });
            }
        });

        // Make functions globally available
        window.loadProducts = loadProducts;
        window.filterProducts = filterProducts;
        window.filterByCategory = filterByCategory;
        window.updateProductStock = updateProductStock;
        window.updateStockQuantity = updateStockQuantity;
        window.saveStockQuantity = saveStockQuantity;
        window.bulkUpdateStock = bulkUpdateStock;

    </script>
</body>
</html>