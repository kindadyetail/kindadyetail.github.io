<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kindady's E-tail | E-tail with Heart</title>
    <meta name="description" content="Curated luxury lifestyle products - clothes, perfumes, shoes & accessories. Kindly selected, beautifully presented.">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">

    <!-- FAVICON CONFIGURATION -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ed64a6">
    <meta name="msapplication-TileColor" content="#1a365d">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDfpoqyjtO7VueYtcGEYTfkWHOl4YNG7sk",
            authDomain: "kindadys-9924e.firebaseapp.com",
            projectId: "kindadys-9924e",
            storageBucket: "kindadys-9924e.firebasestorage.app",
            messagingSenderId: "772017587580",
            appId: "1:772017587580:web:82cd5c27edf6bfc44c50f9",
            measurementId: "G-D74KTPX92D"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Export to global scope
        window.firestoreDB = db;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseQuery = query;
        window.firebaseOrderBy = orderBy;
        window.firebaseAddDoc = addDoc;
        
        console.log("Firebase loaded on main page!");
    </script>



    <style>
        /* ... (keep all your existing styles exactly as they are) ... */
        
        /* Add notification test button */
        .test-notification-btn {
            position: fixed;
            bottom: 120px;
            right: 20px;
            background: #2196F3;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            z-index: 100;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
            transition: all 0.3s;
        }
        
        .test-notification-btn:hover {
            background: #0b7dda;
            transform: translateY(-2px);
        }

             /* Additional styles for improved product grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .product-image-container {
            width: 100%;
            height: 280px;
            overflow: hidden;
            position: relative;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .product-image {
            transform: scale(1.05);
        }
        
        .product-details {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-category {
            display: inline-block;
            background: #e2e8f0;
            color: #4a5568;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 10px;
            align-self: flex-start;
        }
        
        .product-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
            line-height: 1.4;
        }
        
        .product-price {
            color: #ed64a6;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        /* Product Tags in Product Card */
        .product-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
            min-height: 24px;
        }
        
        .product-tag {
            background: rgba(101, 126, 234, 0.1);
            color: #667eea;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
            border: 1px solid rgba(101, 126, 234, 0.2);
        }
        
        .add-to-cart {
            background: #1a365d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
            margin-top: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-to-cart:hover {
            background: #2d3748;
        }
        
        /* Filters */
        .filters {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #4a5568;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: #ed64a6;
            color: white;
            border-color: #ed64a6;
        }
        
        .filter-btn:hover:not(.active) {
            border-color: #cbd5e0;
            background: #f7fafc;
        }
        
        /* Loading State */
        .product-loading {
            text-align: center;
            padding: 60px 20px;
            grid-column: 1 / -1;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ed64a6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: none;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.show {
            display: block;
        }
        
        /* Admin Upload Link */
        .admin-upload-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            font-size: 14px;
        }
        
        .admin-upload-link:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        /* Cart Count */
        .cart-count {
            background: #ed64a6;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            position: absolute;
            top: -8px;
            right: -8px;
        }

        
        .sync-button:hover {
            background: #5a67d8;
        }
        
        .products-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .products-stats {
            font-size: 14px;
            color: #666;
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .products-stats i {
            color: #ed64a6;
        }

          /* Hero Image Grid Overlay */
    .hero-image .grid-item {
        position: relative;
        cursor: pointer;
        overflow: hidden;
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .hero-image .grid-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .hero-image .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(237, 100, 166, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 10px;
    }
    
    .hero-image .grid-item:hover .image-overlay {
        opacity: 1;
    }
    
    .hero-image .image-overlay span {
        color: white;
        font-weight: 600;
        font-size: 16px;
        text-align: center;
        padding: 10px 20px;
        background: rgba(26, 54, 93, 0.8);
        border-radius: 20px;
    }
    
    /* Hero Tags as Clickable Buttons */
    .hero-tags .tag {
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .hero-tags .tag:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(237, 100, 166, 0.3);
        background: #ed64a6 !important;
        color: white !important;
    }
    
    .hero-tags .tag:active {
        transform: translateY(0);
    }
    
    /* Add a pulsing animation for tags */
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(237, 100, 166, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(237, 100, 166, 0); }
        100% { box-shadow: 0 0 0 0 rgba(237, 100, 166, 0); }
    }
    
    .hero-tags .tag:hover {
        animation: pulse 1.5s infinite;
    }

     /* Universal Search Styles */
/* Universal Search Styles - REDUCED WIDTH */
    .search-container {
        flex: 0 1 300px; /* Changed from 400px to 300px */
        max-width: 300px; /* Reduced from 400px */
        margin: 0 20px;
        position: relative;
        min-width: 200px; /* Added minimum width */
    }
    
    .search-box {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 30px;
        padding: 8px 15px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        width: 100%; /* Ensures it takes full container width */
    }
    
    .search-box:focus-within {
        border-color: #ed64a6;
        box-shadow: 0 4px 20px rgba(237, 100, 166, 0.15);
        transform: translateY(-1px);
    }
    
    .search-icon {
        color: #9ca3af;
        margin-right: 10px;
        font-size: 16px;
        flex-shrink: 0;
    }
    
    .search-input {
        flex: 1;
        border: none;
        background: transparent;
        outline: none;
        font-size: 14px;
        color: #374151;
        font-family: 'Poppins', sans-serif;
        min-width: 0; /* Allows input to shrink properly */
        width: 100%; /* Takes available space */
    }
    
    .search-input::placeholder {
        color: #9ca3af;
        font-size: 13px; /* Slightly smaller placeholder */
    }
    
    .search-clear {
        background: none;
        border: none;
        color: #9ca3af;
        cursor: pointer;
        padding: 0;
        margin-left: 5px;
        opacity: 0;
        transition: opacity 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        flex-shrink: 0;
    }
    
    .search-clear.show {
        opacity: 1;
    }
    
    .search-clear:hover {
        color: #ef4444;
    }
    
    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-top: 10px;
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        border: 1px solid #e5e7eb;
        min-width: 300px; /* Minimum width for dropdown */
    }
    
    .search-results.show {
        display: block;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .search-result-item {
        padding: 12px 15px; /* Slightly reduced padding */
        border-bottom: 1px solid #f3f4f6;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px; /* Reduced gap */
        transition: background 0.2s ease;
    }
    
    .search-result-item:hover {
        background: #f9fafb;
    }
    
    .search-result-item:last-child {
        border-bottom: none;
    }
    
    .search-result-image {
        width: 45px; /* Slightly smaller */
        height: 45px;
        border-radius: 8px;
        object-fit: cover;
        border: 1px solid #e5e7eb;
        flex-shrink: 0;
    }
    
    .search-result-info {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }
    
    .search-result-title {
        font-weight: 500;
        color: #1f2937;
        font-size: 13px; /* Slightly smaller font */
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .search-result-category {
        font-size: 11px; /* Smaller font */
        color: #6b7280;
        background: #f3f4f6;
        padding: 2px 8px;
        border-radius: 12px;
        display: inline-block;
        white-space: nowrap;
    }
    
    .search-result-price {
        color: #ed64a6;
        font-weight: 600;
        font-size: 13px;
        margin-left: 8px;
        flex-shrink: 0;
    }
    
    .search-no-results {
        padding: 15px; /* Reduced padding */
        text-align: center;
        color: #6b7280;
        font-size: 13px;
    }
    
    .search-no-results i {
        font-size: 20px; /* Smaller icon */
        margin-bottom: 8px;
        display: block;
        color: #d1d5db;
    }
    
    .search-result-highlight {
        background-color: #fff3cd;
        padding: 1px 3px;
        border-radius: 3px;
        color: #856404;
    }
    
    /* Tag-specific search result styles */
    .search-result-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 4px;
    }
    
    .search-result-tag {
        background: rgba(101, 126, 234, 0.1);
        color: #667eea;
        padding: 1px 6px;
        border-radius: 10px;
        font-size: 10px;
        border: 1px solid rgba(101, 126, 234, 0.2);
    }
    
    .search-result-match-type {
        font-size: 10px;
        color: #10b981;
        background: #f0fdf4;
        padding: 2px 6px;
        border-radius: 10px;
        border: 1px solid #bbf7d0;
        margin-left: 5px;
        font-weight: 500;
    }
    
    /* Tag search section in results */
    .search-tag-section {
        padding: 10px 15px;
        border-bottom: 1px solid #f3f4f6;
        background: #f9fafb;
    }
    
    .search-tag-title {
        font-size: 12px;
        font-weight: 600;
        color: #4b5563;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .search-tag-title i {
        color: #667eea;
    }
    
    .search-tag-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .search-tag-item {
        background: white;
        border: 1px solid #e5e7eb;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 11px;
        color: #374151;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .search-tag-item:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
        transform: translateY(-1px);
    }
    
    /* Mobile responsive for search - UPDATED */
    @media (max-width: 768px) {
        .search-container {
            order: 3;
            max-width: 100%;
            margin: 15px 0 0 0;
            width: 100%;
            flex: 1 1 100%;
        }
        
        .nav-container {
            flex-wrap: wrap;
        }
        
        .logo {
            flex: 1;
        }
        
        .search-box {
            width: 100%;
        }
        
        .search-results {
            position: fixed;
            top: 70px;
            left: 10px;
            right: 10px;
            max-height: 60vh;
            min-width: calc(100vw - 20px); /* Full width minus padding */
        }
    }
    
    /* For tablets */
    @media (max-width: 1024px) {
        .search-container {
            max-width: 250px; /* Reduced for tablets */
            flex: 0 1 250px;
        }
    }
    
    /* For very small screens */
    @media (max-width: 640px) {
        .search-container {
            max-width: 100%;
            flex: 1 1 100%;
        }
        
        .search-input::placeholder {
            font-size: 12px; /* Even smaller on mobile */
        }
    }
    
    /* Make the nav container flexible */
    .nav-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px; /* Reduced gap */
    }
    
    /* Adjust logo and navigation spacing */
    .logo {
        flex: 0 1 auto;
    }

    /* NEW STYLES FOR CHECKOUT FORM */
    .small-checkbox input[type="checkbox"] {
        transform: scale(0.8);
        margin-right: 5px;
    }

    .small-checkbox span {
        font-size: 12px !important;
        line-height: 1.4;
    }

    .payment-instructions {
        background: #f8fafc;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        margin-top: 15px;
    }

    .payment-instructions h5 {
        margin-top: 0;
        color: #1a365d;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .instructions-list {
        margin: 10px 0;
        padding-left: 20px;
        font-size: 13px;
    }

    .instructions-list li {
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .seller-contact {
        background: #fff3cd;
        padding: 12px;
        border-radius: 6px;
        border-left: 4px solid #ffc107;
        margin-top: 15px;
        font-size: 13px;
    }

    .seller-contact p {
        margin: 5px 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .call-notice {
        background: #d1ecf1;
        padding: 8px;
        border-radius: 4px;
        color: #0c5460;
        border-left: 3px solid #17a2b8;
        margin-top: 10px !important;
    }

    /* Delivery fee notice */
    .delivery-fee-notice {
        background: #f8d7da;
        padding: 10px;
        border-radius: 6px;
        border-left: 4px solid #dc3545;
        font-size: 13px;
        color: #721c24;
        margin-bottom: 15px;
    }

    .delivery-fee-notice i {
        color: #dc3545;
    }
    
    /* Update Contact form to match email field */
    .contact-form .form-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 14px;
        color: #4a5568;
        font-weight: 500;
    }
    
    .contact-form .form-hint {
        font-size: 12px;
        color: #718096;
        margin-top: 4px;
        display: block;
    }
   

    /* Tiny checkbox styles */
.tiny-checkbox {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    font-size: 12px;
    color: #4b5563;
    cursor: pointer;
    line-height: 1.3;
}

.tiny-checkbox input[type="checkbox"] {
    width: 14px !important;
    height: 14px !important;
    margin: 0 !important;
    margin-right: 8px !important;
    margin-top: 1px !important;
    flex-shrink: 0;
    transform: scale(1);
    cursor: pointer;
}

.tiny-checkbox span {
    font-size: 12px;
    line-height: 1.3;
    display: inline;
    vertical-align: top;
}
    </style>
</head>
<body>
   <!-- Update the Navigation section -->
<header class="header">
    <nav class="nav-container">
        <div class="logo">
            <a href="#home" class="logo-link">
                <div class="logo-combined">
                    <div class="logo-image">
                        <img src="images/favicon-32x32.png" alt="Kindady's E-tail">
                    </div>
                    <div class="logo-words">
                        <span class="logo-main">KINDADY'S</span>
                        <span class="logo-tagline">E-tail with Heart</span>
                    </div>
                </div>
            </a>
        </div>
        
        <!-- Search Bar - New Addition -->
        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       id="universalSearch" 
                       class="search-input" 
                       placeholder="Search products, collections, tags..."
                       onkeyup="handleSearch(event)">
                <button class="search-clear" id="searchClear" onclick="clearSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-results" id="searchResultsDropdown"></div>
        </div>
        
        <div class="nav-toggle" id="navToggle">
            <i class="fas fa-bars"></i>
        </div>
        
        <ul class="nav-menu" id="navMenu">
            <li><a href="#home" class="nav-link active">Home</a></li>
            <li><a href="#collections" class="nav-link">Collections</a></li>
            <li><a href="#products" class="nav-link">Products</a></li>
            <li><a href="#about" class="nav-link">Our Story</a></li>
            <li><a href="#contact" class="nav-link">Contact</a></li>
            <li class="cart-icon">
                <a href="#cart" id="cartBtn">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
            </li>
            <li class="admin-nav-item">
                <a href="upload.html" class="nav-link" style="color: #ed64a6;">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span style="font-size: 12px;">Upload</span>
                </a>
            </li>
        </ul>
    </nav>
</header>

  <!-- Hero Section -->
<section class="hero" id="home">
    <div class="hero-content">
        <h1 class="hero-title">E-tail with <span class="heart-text">Heart</span></h1>
        <p class="hero-subtitle">Curated luxury lifestyle products, kindly selected for you</p>
        <div class="hero-tags">
            <span class="tag" onclick="filterProductsByCategory('clothing')">Clothing</span>
            <span class="tag" onclick="filterProductsByCategory('fragrance')">Perfumes</span>
            <span class="tag" onclick="filterProductsByCategory('footwear')">Shoes</span>
            <span class="tag" onclick="filterProductsByCategory('accessories')">Accessories</span>
        </div>
        <a href="#collections" class="btn btn-primary">Explore Collections</a>
    </div>
    <div class="hero-image">
        <div class="image-grid">
            <div class="grid-item" onclick="filterProductsByCategory('clothing')">
                <img src="https://images.unsplash.com/photo-1490481651871-ab68de25d43d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400" alt="Luxury Clothing">
                <div class="image-overlay">
                    <span>Shop Clothing</span>
                </div>
            </div>
            <div class="grid-item" onclick="filterProductsByCategory('fragrance')">
                <img src="https://images.unsplash.com/photo-1541643600914-78b084683601?ixlib=rb-4.0.3&auto=format&fit=crop&w=400" alt="Designer Perfumes">
                <div class="image-overlay">
                    <span>Shop Fragrances</span>
                </div>
            </div>
            <div class="grid-item" onclick="filterProductsByCategory('footwear')">
                <img src="https://res.cloudinary.com/dkajyfuab/image/upload/v1769360254/collection/h3x3tdywxy7boskkks3q.jpg" alt="Premium Shoes">
                <div class="image-overlay">
                    <span>Shop Footwear</span>
                </div>
            </div>
            <div class="grid-item" onclick="filterProductsByCategory('accessories')">
                <img src="https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?ixlib=rb-4.0.3&auto=format&fit=crop&w=400" alt="Lifestyle Accessories">
                <div class="image-overlay">
                    <span>Shop Accessories</span>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Value Proposition -->
    <section class="values-section">
        <div class="container">
            <div class="values-grid">
                <div class="value-card">
                    <div class="value-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>Kindly Curated</h3>
                    <p>Every product is hand-selected with care and consideration</p>
                </div>
                <div class="value-card">
                    <div class="value-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3>Premium Quality</h3>
                    <p>Only the finest materials and craftsmanship</p>
                </div>
                <div class="value-card">
                    <div class="value-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h3>Personal Service</h3>
                    <p>Warm, personalized attention to every customer</p>
                </div>
                <div class="value-card">
                    <div class="value-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <h3>Reliable Delivery</h3>
                    <p>Fast and secure delivery across all regions in Ghana</p>
                </div>
            </div>
        </div>
    </section>
<!-- Update your Collections section - add onclick handlers -->
<section class="collections-section" id="collections">
    <div class="container">
        <h2 class="section-title">Our <span class="highlight">Collections</span></h2>
        <p class="section-subtitle">Beautifully organized by lifestyle categories</p>
        
        <div class="collections-grid">
            <div class="collection-card" onclick="filterProductsByCategory('clothing')">
                <div class="collection-image">
                    <img src="https://images.unsplash.com/photo-1445205170230-053b83016050?ixlib=rb-4.0.3&auto=format&fit=crop&w=600" alt="Clothing Collection">
                    <div class="collection-overlay">
                        <h3>Clothing</h3>
                        <p>Elevated everyday wear</p>
                        <span class="btn-collection">View Collection</span>
                    </div>
                </div>
            </div>
            
            <div class="collection-card" onclick="filterProductsByCategory('fragrance')">
                <div class="collection-image">
                    <img src="https://images.unsplash.com/photo-1541643600914-78b084683601?ixlib=rb-4.0.3&auto=format&fit=crop&w=600" alt="Fragrance Collection">
                    <div class="collection-overlay">
                        <h3>Fragrances</h3>
                        <p>Scents that tell stories</p>
                        <span class="btn-collection">View Collection</span>
                    </div>
                </div>
            </div>
            
            <div class="collection-card" onclick="filterProductsByCategory('footwear')">
                <div class="collection-image">
                    <img src="https://res.cloudinary.com/dkajyfuab/image/upload/v1769360254/collection/h3x3tdywxy7boskkks3q.jpg" alt="Footwear Collection">
                    <div class="collection-overlay">
                        <h3>Footwear</h3>
                        <p>Steps in comfort & style</p>
                        <span class="btn-collection">View Collection</span>
                    </div>
                </div>
            </div>
            
            <div class="collection-card" onclick="filterProductsByCategory('accessories')">
                <div class="collection-image">
                    <img src="https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?ixlib=rb-4.0.3&auto=format&fit=crop&w=600" alt="Accessories Collection">
                    <div class="collection-overlay">
                        <h3>Accessories</h3>
                        <p>Finishing touches</p>
                        <span class="btn-collection">View Collection</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Update Products section - add IDs for dynamic updates -->
<section class="products-section" id="products">
    <div class="container">
        <h2 class="section-title" id="productsTitle">Featured <span class="highlight">Products</span></h2>
        <p class="section-subtitle" id="productsSubtitle">Kindady's hand-picked favorites</p>
        
        <div class="products-controls">
       <!-- Update the filter button - remove "shoes" and use "footwear" consistently -->
<div class="filters">
    <button class="filter-btn active" data-filter="all" onclick="filterProducts('all')">All Products</button>
    <button class="filter-btn" data-filter="clothing" onclick="filterProducts('clothing')">Clothing</button>
    <button class="filter-btn" data-filter="fragrance" onclick="filterProducts('fragrance')">Fragrances</button>
    <button class="filter-btn" data-filter="footwear" onclick="filterProducts('footwear')">Footwear</button>
    <button class="filter-btn" data-filter="accessories" onclick="filterProducts('accessories')">Accessories</button>
</div>
            
            <div class="products-stats" id="productsStats">
                <i class="fas fa-database"></i>
                <span id="productCount">Loading...</span>
            </div>
            
            <button class="sync-button" onclick="loadProductsFromFirebase()">
                <i class="fas fa-sync-alt"></i>
                Refresh Products
            </button>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <div class="product-loading">
                <div class="loading-spinner"></div>
                <p>Loading products from your collection...</p>
            </div>
        </div>
    </div>
</section>

       <!-- About Section -->
    <section class="about-section" id="about">
        <div class="container">
            <div class="about-grid">
                <div class="about-image">
                    <div class="image-frame">
                        <img src="https://res.cloudinary.com/dzoq4pgjn/image/upload/v1769299772/n9mghgleavmzhnuurcbh.jpg" alt="Kindady's Founder">
                        <div class="image-badge">
                            <i class="fas fa-heart"></i>
                            <span>Founded with Love</span>
                        </div>
                    </div>
                </div>
                <div class="about-content">
                    <h2 class="section-title">Our <span class="highlight">Story</span></h2>
                    <h3>Hello, I'm Miss Dora</h3>
                    <p>Kindady's E-tail began as a passion project right here in Accra, born from my love for helping friends find pieces that truly fit their personalities. After years of being the go-to, I realized Ghana needed a more personal shopping experience.</p>
                    <p>Every item in our collection is personally tested and selected. We focus on quality over quantity, choosing pieces that work for Ghanaian lifestyles - from our weather to our celebrations. I personally handle every order to ensure you get exactly what you love.</p>
              
                    <a href="#contact" class="btn btn-secondary">Chat with Me</a>
                </div>
            </div>
        </div>
    </section>

  <!-- Contact Section -->
<section class="contact-section" id="contact">
    <div class="container">
        <h2 class="section-title">Get in <span class="highlight">Touch</span></h2>
        <p class="section-subtitle">We'd love to hear from you</p>
        
        <div class="contact-grid">
            <div class="contact-info">
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h4>Visit Us</h4>
                    <p>Accra, Ghana<br>We deliver across all regions<br>Within Ghana borders</p>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <h4>Call Us</h4>
                    <p>
                        <a href="tel:+233595736002" class="contact-link">
                            0595736002
                        </a>
                    </p>
                    <p>Mon-Fri: 9am-6pm GMT</p>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h4>Email Us</h4>
                    <p>
                        <a href="mailto:kindadyetail@gmail.com" class="contact-link">
                            kindadyetail@gmail.com
                        </a>
                    </p>
                    <p>Response within 24 hours</p>
                </div>
                
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-pinterest"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-tiktok"></i></a>
                </div>
            </div>
            
            <div class="contact-form">
                <form id="contactForm">
                    <div class="form-group">
                        <input type="text" id="name" placeholder="Your Name *" required>
                    </div>
                    <div class="form-group">
                        <input type="tel" id="contactPhone" placeholder="Your WhatsApp Number *" required pattern="0[0-9]{9}">
                        <small class="form-hint">Required 10-digit Ghana number starting with 0</small>
                    </div>
                    <div class="form-group">
                        <input type="email" id="contactEmail" placeholder="Your Email (Optional)">
                        <small class="form-hint">Optional - for receipts and updates</small>
                    </div>
                    <div class="form-group">
                        <select id="contactSubject" class="form-control">
                            <option value="">Select Subject (Optional)</option>
                            <option value="order_inquiry">Order Inquiry</option>
                            <option value="product_question">Product Question</option>
                            <option value="sizing_help">Sizing Help</option>
                            <option value="delivery_question">Delivery Question</option>
                            <option value="general">General Inquiry</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea id="message" rows="5" placeholder="How can we help you today? *" required></textarea>
                    </div>
                    
                    <div class="form-footer">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                        <div class="whatsapp-direct">
                            <p>or</p>
                            <a href="https://wa.me/233595736002" class="btn btn-success" target="_blank">
                                <i class="fab fa-whatsapp"></i> Chat Directly on WhatsApp
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
    <!-- Newsletter -->
    <section class="newsletter-section">
        <div class="container">
            <div class="newsletter-box">
                <div class="newsletter-content">
                    <h3>Join Our Kind Community</h3>
                    <p>Subscribe for exclusive offers, new arrivals, and heartfelt stories</p>
                </div>
                <div class="newsletter-form">
                    <input type="email" placeholder="Your email address">
                    <button class="btn btn-primary">Subscribe</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="footer-logo">
                        <span class="logo-text">KINDADY'S</span>
                        <span class="logo-sub">E-TAIL</span>
                    </div>
                    <p class="footer-tagline">E-tail with Heart</p>
                    <p>Curated luxury lifestyle products, kindly selected and beautifully presented for those who value quality, style, and genuine connection.</p>
                </div>
                
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#collections">Collections</a></li>
                        <li><a href="#products">Shop All</a></li>
                        <li><a href="#about">Our Story</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4>Customer Care</h4>
                    <ul>
                        <li><a href="#">Delivery Policy</a></li>
                        <li><a href="#">Returns & Exchanges</a></li>
                        <li><a href="#">Size Guide</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4>Stay Connected</h4>
                    <p>Follow us for daily inspiration, styling tips, and behind-the-scenes moments.</p>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-pinterest"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                    <div class="payment-methods">
                        <i class="fas fa-money-bill-wave"></i>
                        <i class="fas fa-mobile-alt"></i>
                        <i class="fas fa-university"></i>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Kindady's E-tail. All rights reserved. | Designed with <i class="fas fa-heart"></i> by Kindady's Team</p>
            </div>
        </div>
    </footer>

    <!-- Admin Upload Link -->
    <a href="seller.html" class="admin-upload-link">
        <i class="fas fa-cloud-upload-alt"></i>
        Dashboard
    </a>

    <!-- Test Notification Button -->
   <button class="test-notification-btn" onclick="testNotificationSystem()">
    <i class="fas fa-bell"></i> Test Notifications
</button>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Cart Modal -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <div class="cart-header">
                <h3><i class="fas fa-shopping-bag"></i> Your Shopping Bag</h3>
                <button class="close-cart" id="closeCart">&times;</button>
            </div>
            <div class="cart-items" id="cartItems">
                <p class="empty-cart">Your bag is empty</p>
            </div>
            <div class="cart-total">
                <div class="total-line">
                    <span>Subtotal:</span>
                    <span>GHS â‚µ<span id="cartSubtotal">0.00</span></span>
                </div>
                <div class="total-line">
                    <span>Delivery:</span>
                    <span id="shippingCost">GHS â‚µ50.00</span>
                </div>
                <div class="total-line grand-total">
                    <span>Total:</span>
                    <span>GHS â‚µ<span id="cartTotal">0.00</span></span>
                </div>
                <button class="btn btn-checkout">Proceed to Checkout</button>
                <p class="continue-shopping">or <a href="#products">continue shopping</a></p>
            </div>
        </div>
    </div>

   <script>
    // Send WhatsApp notification to seller
function sendWhatsAppNotification(orderData) {
    console.log('ðŸ“± Starting WhatsApp notification...');
    
    // Seller's WhatsApp number (233 format for WhatsApp)
    const sellerNumber = '233595736002';
    
    // Clean customer phone for WhatsApp link
    const customerPhone = cleanPhoneNumber(orderData.customer.phone);
    
    // Create detailed message for seller
  const sellerMessage = encodeURIComponent(
    `NEW ORDER - Kindady's E-tail\n\n` +
    `Order ID: ${orderData.orderId}\n` +
    `Date: ${new Date().toLocaleString('en-GH', { timeZone: 'Africa/Accra' })}\n\n` +
    `Customer Information\n` +
    `Name: ${orderData.customer.name}\n` +
    `Phone: ${orderData.customer.phone}\n` +
    `Address: ${orderData.customer.address}, ${orderData.customer.city}\n` +
    `Region: ${orderData.customer.region}\n\n` +
    `Order Summary\n` +
    `Subtotal: GHS â‚µ${parseFloat(orderData.orderDetails.subtotal).toFixed(2)}\n` +
    `Delivery: GHS â‚µ${parseFloat(orderData.orderDetails.delivery).toFixed(2)}\n` +
    `TOTAL: GHS â‚µ${parseFloat(orderData.orderDetails.total).toFixed(2)}\n\n` +
    `Payment Method: ${formatPaymentMethod(orderData.payment.method)}\n` +
    `Status: ${formatPaymentStatus(orderData.payment.status)}\n\n` +
    `Items (${orderData.orderDetails.itemCount}):\n` +
    orderData.orderDetails.items.map((item, index) => 
        `${index + 1}. ${item.title} Ã— ${item.quantity} = GHS â‚µ${(item.price * item.quantity).toFixed(2)}`
    ).join('\n') + '\n\n' +
    `Customer WhatsApp: https://wa.me/${customerPhone}\n` +
    `Call Customer: ${orderData.customer.phone}\n\n` +
    `Please process this order promptly.`
);
    // Create WhatsApp URL
    const whatsappUrl = `https://wa.me/${sellerNumber}?text=${sellerMessage}`;
    
    // Open in new tab
    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
    
    console.log('âœ… WhatsApp notification sent!');
    return true;
}

// Helper functions for notifications
function cleanPhoneNumber(phone) {
    if (!phone) return '';
    // Remove all non-digits
    let clean = phone.replace(/\D/g, '');
    
    // Convert to international format for WhatsApp
    if (clean.startsWith('0')) {
        clean = '233' + clean.substring(1);
    } else if (clean.startsWith('233')) {
        // Already in correct format
    } else {
        clean = '233' + clean;
    }
    
    return clean;
}

function formatPaymentMethod(method) {
    const methods = {
        'mobile_money': 'Mobile Money',
        'cash_on_delivery': 'Cash on Delivery',
        'bank_transfer': 'Bank Transfer'
    };
    return methods[method] || method;
}

function formatPaymentStatus(status) {
    const statuses = {
        'pending': 'Pending',
        'awaiting_payment': 'Awaiting Payment',
        'paid': 'Paid'
    };
    return statuses[status] || status;
}

// Test notification system
function testNotificationSystem() {
    console.log('ðŸ§ª Testing notification system...');
    
    showNotification('<i class="fas fa-spinner fa-spin"></i> Testing notifications...', 'info');
    
    const testOrder = {
        orderId: 'TEST-' + Date.now().toString().slice(-6),
        customer: {
            name: "Test Customer",
            phone: "0551234567",
            email: "test@example.com",
            address: "123 Test Street, East Legon",
            city: "Accra",
            region: "Greater Accra"
        },
        orderDetails: {
            items: [
                { title: "Premium Leather Handbag", quantity: 1, price: 299.99 },
                { title: "Designer Sunglasses", quantity: 2, price: 89.99 }
            ],
            subtotal: 479.97,
            delivery: 50.00,
            total: 529.97,
            itemCount: 3
        },
        payment: {
            method: "mobile_money",
            status: "awaiting_payment"
        }
    };
    
    try {
        // Test WhatsApp only
        sendWhatsAppNotification(testOrder);
        
        showNotification(`
            <i class="fas fa-check-circle"></i> 
            <strong>Test Successful!</strong><br>
            <small>WhatsApp notification sent</small>
        `, 'success');
        
    } catch (error) {
        console.error('Test failed:', error);
        showNotification(`
            <i class="fas fa-times-circle"></i> 
            <strong>Test Failed</strong><br>
            <small>${error.message}</small>
        `, 'error');
    }
}

// =============== PROCESS PAYMENT FUNCTION ===============
async function processPayment() {
    // Get form values
    const name = document.getElementById('checkoutName')?.value || '';
    const email = document.getElementById('checkoutEmail')?.value || '';
    const phone = document.getElementById('checkoutPhone')?.value || '';
    const address = document.getElementById('checkoutAddress')?.value || '';
    const city = document.getElementById('checkoutCity')?.value || '';
    const region = document.getElementById('checkoutRegion')?.value || '';
    const paymentMethod = document.getElementById('checkoutPayment')?.value || '';
    const termsAgreed = document.getElementById('termsAgreement')?.checked || false;
    
    // Validate all fields
    if (!name || !phone || !address || !city || !region || !paymentMethod || !termsAgreed) {
        showNotification('<i class="fas fa-exclamation-circle"></i> Please fill in all required fields and accept terms', 'error');
        return;
    }
    
    // Validate phone number
    const phoneRegex = /^0[0-9]{9}$/;
    if (!phoneRegex.test(phone)) {
        showNotification('<i class="fas fa-exclamation-circle"></i> Please enter a valid 10-digit Ghana phone number starting with 0 (e.g., 0551234567)', 'error');
        return;
    }
    
    // Get order summary
    const orderSummary = JSON.parse(localStorage.getItem('kindadys_last_order') || '{}');
    
    // Show processing animation
    const payBtn = document.querySelector('.btn-success');
    const originalText = payBtn.innerHTML;
    payBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    payBtn.disabled = true;
    
    try {
        // Prepare order data for Firebase
        const orderData = {
            customer: {
                name: name,
                email: email || '', // Optional
                phone: phone,
                address: address,
                city: city,
                region: region
            },
            orderDetails: {
                items: orderSummary.items,
                subtotal: parseFloat(orderSummary.totals.subtotal),
                delivery: parseFloat(orderSummary.totals.delivery),
                total: parseFloat(orderSummary.totals.total),
                itemCount: orderSummary.totals.itemCount
            },
            payment: {
                method: paymentMethod,
                status: paymentMethod === 'cash_on_delivery' ? 'pending' : 'awaiting_payment',
                details: getPaymentDetails(paymentMethod)
            },
            status: 'pending',
            orderId: orderSummary.orderId,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            sellerInfo: {
                phone: "0595736002",
                email: "kindadyetail@gmail.com",
                paymentNumber: "0595736002"
            }
        };
        
        console.log('ðŸ’¾ Saving order to Firebase...');
        
        // 1. Save order to Firebase
        const db = window.firestoreDB;
        const ordersCollection = window.firebaseCollection(db, 'orders');
        const docRef = await window.firebaseAddDoc(ordersCollection, orderData);
        
        console.log('âœ… Order saved to Firebase with ID:', docRef.id);
        
        // 2. Send WhatsApp notification
        console.log('ðŸ“± Sending WhatsApp notification...');
        try {
            sendWhatsAppNotification(orderData);
            console.log('âœ… WhatsApp notification sent successfully');
        } catch (notificationError) {
            console.warn('âš ï¸ WhatsApp notification failed, but order saved:', notificationError);
        }
        
        // 3. Clear cart
        clearCart(false);
        
        // 4. Close checkout modal
        closeCheckoutModal();
        
        // 5. Show success message
        showNotification(`
            <i class="fas fa-check-circle"></i> 
            <strong>Order Confirmed!</strong><br>
            Order #${orderData.orderId}<br>
            <small>Seller notified via WhatsApp</small>
        `, 'success');
        
        // 6. Show order confirmation page
        setTimeout(() => {
            showOrderConfirmation(orderData, orderData.orderId, docRef.id);
        }, 1500);
        
    } catch (error) {
        console.error('âŒ Error processing order:', error);
        
        // Restore button
        payBtn.innerHTML = originalText;
        payBtn.disabled = false;
        
        showNotification(`
            <i class="fas fa-exclamation-circle"></i> 
            Error processing order. Please try again or call 0595736002
        `, 'error');
    }
}

// Make test function available globally
window.testNotificationSystem = testNotificationSystem;

// =============== CLOUDINARY INTEGRATION SCRIPT ===============
const PRODUCT_CATEGORIES = {
    clothing: ['shirt', 'dress', 'jacket', 'pants', 'sweater', 'blouse', 'skirt', 'top', 'jeans', 'coat', 't-shirt', 'hoodie', 'cardigan', 'jumper'],
    fragrance: ['perfume', 'cologne', 'scent', 'fragrance', 'essence', 'spray', 'bottle', 'aroma', 'oud', 'amber', 'musk', 'rose', 'jasmine'],
    footwear: ['shoe', 'shoes', 'sneaker', 'boot', 'heel', 'sandal', 'loafer', 'footwear', 'feet', 'trainer', 'pump', 'flat', 'slipper', 'slippers', 'mule'],
    accessories: ['bag', 'watch', 'jewelry', 'belt', 'scarf', 'hat', 'sunglasses', 'wallet', 'purse', 'bracelet', 'necklace', 'ring', 'earring', 'tie']
};

let cart = JSON.parse(localStorage.getItem('kindadys_cart')) || [];
let firebaseConnected = false;
let productsFromFirebase = [];
let allProducts = [];
let currentFilter = 'all';

// Tag tracking for search
let allTags = new Set();
let tagFrequency = {};
let productTagMap = {};

// Search functionality variables
let searchTimeout;
let lastSearchQuery = '';

// Check Firebase connection
function checkFirebaseConnection() {
    const indicator = document.createElement('div');
    indicator.className = 'firebase-indicator';
    indicator.id = 'firebaseIndicator';
    document.body.appendChild(indicator);
    
    if (window.firestoreDB) {
        firebaseConnected = true;
        indicator.innerHTML = '<i class="fas fa-check-circle"></i> Firebase Connected';
        indicator.classList.add('connected');
        console.log('Firebase is connected');
        
        // Load products from Firebase
        setTimeout(() => {
            loadProductsFromFirebase();
        }, 1000);
        
    } else {
        indicator.innerHTML = '<i class="fas fa-exclamation-circle"></i> Firebase Not Connected';
        indicator.classList.add('disconnected');
        console.log('Firebase is not connected, loading from localStorage');
        
        // Load from localStorage as fallback
        loadProductsFromLocalStorage();
    }
}

// Enhanced category detection that maps all shoe/slipper/footwear to "footwear"
function detectCategory(filename) {
    if (!filename) return 'clothing';
    
    const lowerFilename = filename.toLowerCase();
    
    // Check for footwear-related terms FIRST (priority)
    const footwearTerms = ['shoe', 'shoes', 'sneaker', 'boot', 'boots', 'heel', 'heels', 'sandal', 'sandals', 
                          'loafer', 'loafers', 'footwear', 'slipper', 'slippers', 'trainer', 'trainers', 
                          'pump', 'pumps', 'flat', 'flats', 'mule', 'mules', 'foot', 'feet'];
    
    for (const term of footwearTerms) {
        if (lowerFilename.includes(term)) {
            return 'footwear';
        }
    }
    
    // Check for fragrance/perfume terms
    const fragranceTerms = ['perfume', 'perfumes', 'cologne', 'colognes', 'fragrance', 'fragrances', 
                           'scent', 'scents', 'essence', 'spray', 'bottle', 'aroma'];
    for (const term of fragranceTerms) {
        if (lowerFilename.includes(term)) {
            return 'fragrance';
        }
    }
    
    // Check for clothing terms
    const clothingTerms = ['shirt', 'dress', 'jacket', 'pants', 'sweater', 'blouse', 'skirt', 'top', 
                          'jeans', 'coat', 't-shirt', 'hoodie', 'cardigan', 'jumper', 'clothing', 'clothes'];
    for (const term of clothingTerms) {
        if (lowerFilename.includes(term)) {
            return 'clothing';
        }
    }
    
    // Check for accessories terms
    const accessoriesTerms = ['bag', 'watch', 'jewelry', 'belt', 'scarf', 'hat', 'sunglasses', 'wallet', 
                             'purse', 'bracelet', 'necklace', 'ring', 'earring', 'tie', 'accessory'];
    for (const term of accessoriesTerms) {
        if (lowerFilename.includes(term)) {
            return 'accessories';
        }
    }
    
    // Default to clothing if nothing matches
    return 'clothing';
}

// When products come from Firebase, ensure consistent categories
function normalizeProductCategories(products) {
    return products.map(product => {
        // If product already has a category, normalize it
        if (product.category) {
            const lowerCategory = product.category.toLowerCase();
            
            // Map variations to standard categories
            if (lowerCategory.includes('shoe') || 
                lowerCategory.includes('slipper') || 
                lowerCategory.includes('foot') ||
                lowerCategory === 'shoes' ||
                lowerCategory === 'footwear') {
                product.category = 'footwear';
            }
            else if (lowerCategory.includes('perfume') || 
                     lowerCategory.includes('fragrance') || 
                     lowerCategory.includes('scent') ||
                     lowerCategory === 'fragrances') {
                product.category = 'fragrance';
            }
            else if (lowerCategory === 'accessory' || 
                     lowerCategory === 'accessories') {
                product.category = 'accessories';
            }
            else if (lowerCategory === 'cloth' || 
                     lowerCategory === 'clothes' ||
                     lowerCategory === 'clothing') {
                product.category = 'clothing';
            }
        } else {
            // If no category, detect it from the name
            product.category = detectCategory(product.name || '');
        }
        
        return product;
    });
}

// Extract and index tags from products
function indexProductTags(products) {
    allTags.clear();
    tagFrequency = {};
    productTagMap = {};
    
    products.forEach(product => {
        const productId = product.firebaseId || product.id;
        const productTags = product.tags || [];
        
        productTagMap[productId] = productTags;
        
        productTags.forEach(tag => {
            allTags.add(tag);
            tagFrequency[tag] = (tagFrequency[tag] || 0) + 1;
        });
    });
    
    console.log(`Indexed ${allTags.size} unique tags from ${products.length} products`);
}

// Load products from Firebase
async function loadProductsFromFirebase() {
    if (!firebaseConnected || !window.firestoreDB) {
        console.log('Firebase not available, using localStorage');
        loadProductsFromLocalStorage();
        return;
    }
    
    const container = document.getElementById('productsGrid');
    const statsEl = document.getElementById('productCount');
    
    try {
        container.innerHTML = `
            <div class="product-loading">
                <div class="loading-spinner"></div>
                <p>Loading products...</p>
            </div>
        `;
        
        // ... rest of your Firebase loading code remains the same
        const db = window.firestoreDB;
        const productsCollection = window.firebaseCollection(db, 'products');
        const q = window.firebaseQuery(productsCollection, window.firebaseOrderBy('createdAt', 'desc'));
        const querySnapshot = await window.firebaseGetDocs(q);
        
        productsFromFirebase = [];
        allProducts = [];
        
        querySnapshot.forEach((doc) => {
            const productData = doc.data();
            const product = {
                id: doc.id,
                ...productData,
                firebaseId: doc.id
            };
            productsFromFirebase.push(product);
        });
        
        console.log(`Loaded ${productsFromFirebase.length} products from Firebase`);
        
        if (productsFromFirebase.length > 0) {
            // Normalize categories for all products
            allProducts = normalizeProductCategories(productsFromFirebase);
            
            // Index tags for search
            indexProductTags(allProducts);
            
            displayProducts(allProducts);
            updateProductStats(allProducts.length, 'Firebase');
            statsEl.innerHTML = `${allProducts.length} products`;
        } else {
            // No products in Firebase, check localStorage
            loadProductsFromLocalStorage();
            statsEl.innerHTML = 'No products, using local storage';
        }
        
    } catch (error) {
        console.error('Error loading from Firebase:', error);
        showNotification('Error loading products. Using local storage.');
        loadProductsFromLocalStorage();
        statsEl.innerHTML = 'Error loading';
    }
}

// Display products function (generic)
function displayProducts(products) {
    const container = document.getElementById('productsGrid');
    
    if (products.length === 0) {
        container.innerHTML = `
            <div class="product-loading" style="grid-column: 1 / -1;">
                <i class="fas fa-box-open" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                <p>No products found in your collection</p>
                <p style="font-size: 14px; color: #666; margin-top: 10px;">
                    Use the <a href="upload.html" style="color: #ed64a6;">Upload Products</a> page to add products
                </p>
            </div>
        `;
        return;
    }
    
    const productsHTML = products.map((product, index) => {
        const productId = product.firebaseId || product.id;
        const category = product.category || detectCategory(product.name || '');
        const price = product.price || generatePrice(index);
        const title = product.name || generateTitle('', category);
        const imageUrl = product.mainImage || product.images?.[0]?.url || product.url || '';
        const tags = productTagMap[productId] || product.tags || [];
        
        // Stock management - get stock from product data
        const stock = product.stock !== undefined ? parseInt(product.stock) : 50;
        const stockStatus = getStockStatus(stock);
        
        // Apply Cloudinary transformations if it's a Cloudinary URL
        let displayImageUrl = imageUrl;
        if (imageUrl.includes('res.cloudinary.com')) {
            displayImageUrl = imageUrl.replace('/upload/', '/upload/w_600,h_600,c_fill/');
        }
        
        // Escape single quotes in title for JavaScript
        const safeTitle = title.replace(/'/g, "\\'");
        const safeDescription = (product.description || '').replace(/'/g, "\\'");
        
        // Stock status HTML - IN DETAILS ONLY
       // Stock status HTML - IN DETAILS ONLY (without quantity number)
const stockStatusHTML = `
    <div class="product-stock-status ${stockStatus.class}">
        <span class="stock-dot ${stockStatus.class}"></span>
        <span>${stockStatus.displayText}</span>
    </div>
`;
        
        return `
            <div class="product-card" data-category="${category}" data-firebase-id="${product.firebaseId || ''}" data-tags="${tags.join(',')}" data-stock="${stock}" data-product-id="${productId}">
                <div class="product-image-container">
                    <img src="${displayImageUrl || 'https://via.placeholder.com/600x600/cccccc/ffffff?text=Product+Image'}" 
                         alt="${title}" 
                         class="product-image" 
                         loading="lazy"
                         onerror="this.src='https://via.placeholder.com/600x600/cccccc/ffffff?text=Image+Not+Available'}">
                </div>
                <div class="product-details">
                    <span class="product-category">${category.charAt(0).toUpperCase() + category.slice(1)}</span>
                    <h3 class="product-title">${title}</h3>
                    <p class="product-price">GHS â‚µ${price.toFixed(2)}</p>
                    
                    <!-- Stock status in details only -->
                    ${stockStatusHTML}
                    
                    ${tags.length > 0 ? `
                        <div class="product-tags-container">
                            ${tags.slice(0, 3).map(tag => `<span class="product-tag">#${tag}</span>`).join('')}
                            ${tags.length > 3 ? `<span class="product-tag">+${tags.length - 3} more</span>` : ''}
                        </div>
                    ` : ''}
                    ${product.brand ? `<p style="font-size: 13px; color: #666; margin-bottom: 10px;">${product.brand}</p>` : ''}
                    ${product.description ? `<p style="font-size: 13px; color: #777; margin-bottom: 15px; line-height: 1.4;">${truncateText(product.description, 80)}</p>` : ''}
                    <button class="add-to-cart" 
                            onclick="addToCart('${safeTitle}', ${price}, '${imageUrl}', '${safeDescription}', '${productId}', '${category}')"
                            ${stock === 0 ? 'disabled' : ''}
                            title="${stock === 0 ? 'This item is currently out of stock' : 'Add to cart'}">
                        <i class="fas ${stock === 0 ? 'fa-ban' : 'fa-shopping-bag'}"></i> 
                        ${stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                    </button>
                </div>
            </div>
        `;
    }).join('');

    container.innerHTML = productsHTML;
    applyCurrentFilter();
}

// Stock status helper function
function getStockStatus(stock) {
    stock = parseInt(stock) || 0;
    
    if (stock === 0) {
        return {
            class: 'out-of-stock',
            icon: 'fa-times-circle',
            text: 'Out of Stock',
            displayText: 'Out of Stock',
            showQuantity: false
        };
    } else if (stock <= 5) {
        return {
            class: 'low-stock',
            icon: 'fa-exclamation-triangle',
            text: 'Low Stock',
            displayText: 'Low Stock',
            showQuantity: true
        };
    } else {
        return {
            class: 'in-stock',
            icon: 'fa-check-circle',
            text: 'In Stock',
            displayText: 'In Stock',
            showQuantity: false
        };
    }
}

// =============== REAL-TIME STOCK UPDATES ===============

// Real-time stock update indicator
let stockUpdateIndicator = null;
let stockUpdateTimeout = null;

// Create stock update indicator
function createStockUpdateIndicator() {
    if (!stockUpdateIndicator) {
        stockUpdateIndicator = document.createElement('div');
        stockUpdateIndicator.className = 'stock-update-indicator';
        stockUpdateIndicator.id = 'stockUpdateIndicator';
        document.body.appendChild(stockUpdateIndicator);
    }
    return stockUpdateIndicator;
}

// Show stock update notification
function showStockUpdate(message, type = 'success') {
    const indicator = createStockUpdateIndicator();
    indicator.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'exclamation-triangle'}"></i>
        <span>${message}</span>
    `;
    indicator.className = `stock-update-indicator ${type} show`;
    
    // Auto-hide after 5 seconds
    clearTimeout(stockUpdateTimeout);
    stockUpdateTimeout = setTimeout(() => {
        indicator.classList.remove('show');
    }, 5000);
}

// Update product stock in real-time
function updateProductStockInRealTime(productId, newStock) {
    try {
        // Find the product card
        const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
        if (!productCard) {
            console.log('Product card not found for:', productId);
            return;
        }
        
        // Update data attribute
        productCard.setAttribute('data-stock', newStock);
        
        // Update stock status display
        const stockStatusDiv = productCard.querySelector('.product-stock-status');
        const addToCartBtn = productCard.querySelector('.add-to-cart');
        const stockStatus = getStockStatus(newStock);
        
        if (stockStatusDiv) {
            stockStatusDiv.className = `product-stock-status ${stockStatus.class}`;
        stockStatusDiv.innerHTML = `
    <span class="stock-dot ${stockStatus.class}"></span>
    <span>${stockStatus.displayText}</span>
`;
        }
        
        // Update add to cart button
        if (addToCartBtn) {
            if (newStock === 0) {
                addToCartBtn.disabled = true;
                addToCartBtn.innerHTML = '<i class="fas fa-ban"></i> Out of Stock';
                addToCartBtn.title = 'This item is currently out of stock';
            } else {
                addToCartBtn.disabled = false;
                addToCartBtn.innerHTML = '<i class="fas fa-shopping-bag"></i> Add to Cart';
                addToCartBtn.title = 'Add to cart';
            }
        }
        
        // Show update notification
        const productTitle = productCard.querySelector('.product-title')?.textContent || 'Product';
        showStockUpdate(`Stock updated: ${productTitle} - ${stockStatus.displayText}`, 'success');
        
        // Update local product data
        const productIndex = allProducts.findIndex(p => 
            (p.firebaseId === productId) || (p.id === productId)
        );
        
        if (productIndex !== -1) {
            allProducts[productIndex].stock = newStock;
        }
        
    } catch (error) {
        console.error('Error updating product stock in real-time:', error);
        showStockUpdate('Error updating stock', 'error');
    }
}

// Listen for real-time stock updates from seller dashboard
function setupStockUpdateListener() {
    // Listen for localStorage changes (when seller updates stock)
    window.addEventListener('storage', (e) => {
        if (e.key === 'stock_updated') {
            try {
                const updateData = JSON.parse(e.newValue);
                if (updateData && updateData.productId && updateData.stock !== undefined) {
                    console.log('Stock update received:', updateData);
                    updateProductStockInRealTime(updateData.productId, updateData.stock);
                    
                    // Update product stats
                    setTimeout(() => {
                        updateProductStats(allProducts.length, 'Firebase', currentFilter);
                    }, 500);
                }
            } catch (error) {
                console.error('Error processing stock update:', error);
            }
        }
    });
    
    // Listen for broadcast channel messages (modern browsers)
    if (typeof BroadcastChannel !== 'undefined') {
        const channel = new BroadcastChannel('stock_updates');
        channel.addEventListener('message', (event) => {
            if (event.data.type === 'stock_updated') {
                const { productId, stock } = event.data;
                console.log('Broadcast channel stock update:', event.data);
                updateProductStockInRealTime(productId, stock);
                
                // Update product stats
                setTimeout(() => {
                    updateProductStats(allProducts.length, 'Firebase', currentFilter);
                }, 500);
            }
        });
    }
    
    // Poll for stock updates (fallback for older browsers)
    let lastStockCheck = Date.now();
    setInterval(() => {
        const now = Date.now();
        if (now - lastStockCheck > 30000) { // Check every 30 seconds
            checkForStockUpdates();
            lastStockCheck = now;
        }
    }, 30000);
}

// Check for stock updates from Firebase
async function checkForStockUpdates() {
    if (!firebaseConnected || !window.firestoreDB) return;
    
    try {
        const db = window.firestoreDB;
        const productsCollection = window.firebaseCollection(db, 'products');
        const q = window.firebaseQuery(productsCollection, window.firebaseOrderBy('updatedAt', 'desc'));
        const querySnapshot = await window.firebaseGetDocs(q);
        
        const updatedProducts = [];
        querySnapshot.forEach((doc) => {
            const productData = doc.data();
            if (productData.updatedAt) {
                const updatedAt = new Date(productData.updatedAt).getTime();
                const lastUpdate = localStorage.getItem(`product_${doc.id}_last_update`) || 0;
                
                if (updatedAt > lastUpdate) {
                    updatedProducts.push({
                        id: doc.id,
                        stock: productData.stock || 50,
                        updatedAt: updatedAt
                    });
                    localStorage.setItem(`product_${doc.id}_last_update`, updatedAt);
                }
            }
        });
        
        // Update any changed products
        updatedProducts.forEach(product => {
            updateProductStockInRealTime(product.id, product.stock);
        });
        
        if (updatedProducts.length > 0) {
            console.log(`Updated ${updatedProducts.length} products`);
        }
        
    } catch (error) {
        console.error('Error checking for stock updates:', error);
    }
}
// Filter products by category
function filterProducts(category) {
    currentFilter = category;
    updateFilterButtons(category);
    
    if (category === 'all') {
        displayProducts(allProducts);
        document.getElementById('productsTitle').innerHTML = 'Featured <span class="highlight">Products</span>';
        document.getElementById('productsSubtitle').textContent = 'Kindady\'s hand-picked favorites';
    } else {
        const filteredProducts = allProducts.filter(product => {
            // Ensure we're comparing with normalized category
            return product.category === category;
        });
        
        displayProducts(filteredProducts);
        
        // Update title based on category
        const categoryTitles = {
            'clothing': 'Clothing',
            'fragrance': 'Fragrances', 
            'footwear': 'Footwear',
            'accessories': 'Accessories'
        };
        
        document.getElementById('productsTitle').innerHTML = `${categoryTitles[category]} <span class="highlight">Collection</span>`;
        document.getElementById('productsSubtitle').textContent = `Explore our curated ${categoryTitles[category].toLowerCase()} selection`;
        
        // Scroll to products section
        document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
    }
    
    updateProductStats(allProducts.length, 'Firebase', category);
}

// Filter products by category from collection cards
// Filter products by category from collection cards
function filterProductsByCategory(category) {
    // Map any shoe/slipper click to "footwear"
    if (category === 'shoes' || category === 'slippers') {
        category = 'footwear';
    }
    
    currentFilter = category;
    updateFilterButtons(category);
    
    const filteredProducts = allProducts.filter(product => {
        return product.category === category;
    });
    
    displayProducts(filteredProducts);
    
    // Update title based on category
    const categoryTitles = {
        'clothing': 'Clothing',
        'fragrance': 'Fragrances',
        'footwear': 'Footwear',
        'accessories': 'Accessories'
    };
    
    document.getElementById('productsTitle').innerHTML = `${categoryTitles[category]} <span class="highlight">Collection</span>`;
    document.getElementById('productsSubtitle').textContent = `Explore our curated ${categoryTitles[category].toLowerCase()} selection`;
    
    // Scroll to products section
    document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
    
    updateProductStats(allProducts.length, 'Firebase', category);
    
    // REMOVED: showNotification(`Viewing ${categoryTitles[category]} collection`);
}
// Filter products by tag
function filterProductsByTag(tag) {
    const filteredProducts = allProducts.filter(product => {
        const productId = product.firebaseId || product.id;
        const productTags = productTagMap[productId] || product.tags || [];
        return productTags.includes(tag);
    });
    
    displayProducts(filteredProducts);
    
    // Update title
    document.getElementById('productsTitle').innerHTML = `Tag: <span class="highlight">#${tag}</span>`;
    document.getElementById('productsSubtitle').textContent = `Products tagged with #${tag}`;
    
    // Reset filter buttons
    updateFilterButtons('all');
    currentFilter = 'all';
    
    // Scroll to products section
    document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
    
    updateProductStats(allProducts.length, 'Firebase', `tag: ${tag}`);
    
    // Show notification
    showNotification(`Showing products tagged #${tag}`);
}

// Update filter buttons
function updateFilterButtons(selectedCategory) {
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
        const filter = button.getAttribute('data-filter');
        if (filter === selectedCategory) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
}

// Apply current filter to displayed products
function applyCurrentFilter() {
    const productCards = document.querySelectorAll('.product-card');
    
    productCards.forEach(card => {
        if (currentFilter === 'all' || card.getAttribute('data-category') === currentFilter) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// Update product statistics - SIMPLIFIED VERSION
function updateProductStats(totalCount, source = 'Local', filter = 'all') {
    const statsEl = document.getElementById('productCount');
    const visibleProducts = document.querySelectorAll('.product-card[style*="block"], .product-card:not([style])').length;
    
    if (filter === 'all') {
        statsEl.innerHTML = `${totalCount} products`;
    } else {
        // Map filter names to better display names
        const filterNames = {
            'clothing': 'Clothing',
            'fragrance': 'Fragrance',
            'footwear': 'Footwear',
            'accessories': 'Accessories'
        };
        
        const displayFilter = filterNames[filter] || filter;
        statsEl.innerHTML = `${visibleProducts} ${displayFilter.toLowerCase()} products`;
    }
}

// Load products from localStorage (fallback)
function loadProductsFromLocalStorage() {
    const container = document.getElementById('productsGrid');
    const statsEl = document.getElementById('productCount');
    
    const uploads = JSON.parse(localStorage.getItem('kindadys_uploads')) || [];
    const firebaseProducts = JSON.parse(localStorage.getItem('kindadys_products')) || [];
    
    // Combine both sources
    const allLocalProducts = [...uploads, ...firebaseProducts];
    
    console.log(`Found ${allLocalProducts.length} products in localStorage`);
    
    if (allLocalProducts.length === 0) {
        showFallbackProducts();
        statsEl.innerHTML = 'No products found. Showing demo products.';
        allProducts = [];
        return;
    }
    
    const imageUploads = allLocalProducts.filter(upload => {
        if (upload.url && (upload.url.includes('.jpg') || upload.url.includes('.jpeg') || upload.url.includes('.png') || upload.url.includes('.webp') || upload.url.includes('.gif'))) {
            return true;
        }
        if (upload.mainImage || upload.images) {
            return true;
        }
        return false;
    });
    
    if (imageUploads.length === 0) {
        showFallbackProducts();
        statsEl.innerHTML = 'No valid products found. Showing demo products.';
        allProducts = [];
        return;
    }
    
    allProducts = normalizeProductCategories(imageUploads);
    
    // Index tags for search
    indexProductTags(allProducts);
    
    displayProducts(allProducts);
    updateProductStats(allProducts.length, 'local storage');
    statsEl.innerHTML = `${allProducts.length} products from local storage`;
}

// Show fallback products (updated to Ghana Cedis)
function showFallbackProducts() {
    const container = document.getElementById('productsGrid');
    
    const fallbackProducts = [
        { 
            id: 'fallback-1',
            name: "Classic White Shirt", 
            price: 89.99, 
            category: "clothing", 
            mainImage: "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            description: "Premium cotton shirt for everyday elegance",
            tags: ["casual", "summer", "essential"]
        },
        { 
            id: 'fallback-2',
            name: "Luxury Perfume", 
            price: 129.99, 
            category: "fragrance", 
            mainImage: "https://images.unsplash.com/photo-1541643600914-78b084683601?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            description: "Signature scent for lasting impression",
            tags: ["elegant", "evening", "luxury"]
        },
        { 
            id: 'fallback-3',
            name: "Leather Boots", 
            price: 159.99, 
            category: "footwear", 
            mainImage: "https://images.unsplash.com/photo-1543163521-1bf539c55dd2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            description: "Handcrafted leather boots for comfort and style",
            tags: ["comfort", "winter", "durable"]
        },
        { 
            id: 'fallback-4',
            name: "Designer Handbag", 
            price: 299.99, 
            category: "accessories", 
            mainImage: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            description: "Chic handbag for modern sophistication",
            tags: ["trendy", "versatile", "luxury"]
        }
    ];

    allProducts = fallbackProducts;
    
    // Index tags for search
    indexProductTags(allProducts);
    
    const productsHTML = fallbackProducts.map(product => {
        const safeTitle = product.name.replace(/'/g, "\\'");
        const safeDescription = (product.description || '').replace(/'/g, "\\'");
        const tags = product.tags || [];
        
        return `
            <div class="product-card" data-category="${product.category}" data-tags="${tags.join(',')}">
                <div class="product-image-container">
                    <img src="${product.mainImage}" alt="${product.name}" class="product-image">
                </div>
                <div class="product-details">
                    <span class="product-category">${product.category.charAt(0).toUpperCase() + product.category.slice(1)}</span>
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-price">GHS â‚µ${product.price.toFixed(2)}</p>
                    ${tags.length > 0 ? `
                        <div class="product-tags-container">
                            ${tags.map(tag => `<span class="product-tag">#${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    ${product.description ? `<p style="font-size: 13px; color: #777; margin-bottom: 15px; line-height: 1.4;">${product.description}</p>` : ''}
                    <button class="add-to-cart" onclick="addToCart('${safeTitle}', ${product.price}, '${product.mainImage}', '${safeDescription}')">
                        <i class="fas fa-shopping-bag"></i> Add to Cart
                    </button>
                </div>
            </div>
        `;
    }).join('');

    container.innerHTML = productsHTML;
    applyCurrentFilter();
}

// Utility functions
function generateTitle(filename, category) {
    if (!filename) {
        const titles = {
            clothing: ['Elegant Blouse', 'Premium Jacket', 'Classic Denim'],
            fragrance: ['Signature Scent', 'Premium Fragrance', 'Luxury Perfume'],
            footwear: ['Designer Shoes', 'Comfort Sneakers', 'Elegant Heels'],
            accessories: ['Chic Handbag', 'Elegant Watch', 'Statement Jewelry']
        };
        const categoryTitles = titles[category] || titles.clothing;
        return categoryTitles[Math.floor(Math.random() * categoryTitles.length)];
    }
    
    const cleanName = filename
        .replace(/\.[^/.]+$/, '')
        .replace(/[_-]/g, ' ')
        .replace(/\d+/g, '')
        .trim();
    
    if (cleanName.length > 3) {
        return cleanName.split(' ')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
    }
    
    return generateTitle('', category);
}

function generatePrice(index) {
    const basePrices = [49.99, 79.99, 89.99, 99.99, 129.99, 149.99];
    return basePrices[index % basePrices.length];
}

function truncateText(text, maxLength) {
    if (!text) return '';
    return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
}

// Shopping cart functionality
function addToCart(title, price, image, description = '') {
    cart.push({
        id: Date.now(),
        title,
        price,
        image,
        description,
        quantity: 1
    });
    
    localStorage.setItem('kindadys_cart', JSON.stringify(cart));
    updateCartCount();
    showNotification(`"${title}" added to cart!`);
}

function updateCartCount() {
    const cartCount = document.getElementById('cartCount');
    if (cartCount) {
        cartCount.textContent = cart.length;
    }
}

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    if (!notification) return;
    
    // Set type-based styling
    const typeClasses = {
        success: 'notification-success',
        error: 'notification-error',
        warning: 'notification-warning',
        info: 'notification-info'
    };
    
    // Remove existing type classes
    notification.classList.remove('notification-success', 'notification-error', 'notification-warning', 'notification-info');
    
    // Add new type class
    notification.classList.add(typeClasses[type] || 'notification-success');
    
    // Set message
    notification.innerHTML = message;
    notification.classList.add('show');
    
    // Auto-hide
    const hideTimeout = setTimeout(() => {
        notification.classList.remove('show');
    }, 5000);
    
    // Allow manual dismissal
    notification.onclick = () => {
        clearTimeout(hideTimeout);
        notification.classList.remove('show');
    };
}

// =============== ENHANCED UNIVERSAL SEARCH WITH TAGS ===============
function handleSearch(event) {
    const searchInput = document.getElementById('universalSearch');
    const searchQuery = searchInput.value.trim();
    const clearBtn = document.getElementById('searchClear');
    
    // Show/hide clear button
    if (searchQuery.length > 0) {
        clearBtn.classList.add('show');
    } else {
        clearBtn.classList.remove('show');
        hideSearchResults();
        return;
    }
    
    // If Enter key is pressed
    if (event.key === 'Enter') {
        performSearch(searchQuery);
        return;
    }
    
    // Debounce search to avoid too many requests
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        performSearch(searchQuery);
    }, 300);
}

function performSearch(query) {
    if (query === lastSearchQuery) return;
    lastSearchQuery = query;
    
    const resultsDropdown = document.getElementById('searchResultsDropdown');
    
    if (query.length < 2) {
        hideSearchResults();
        return;
    }
    
    const searchResults = searchProductsAndTags(query);
    displaySearchResults(searchResults, query);
}

function searchProductsAndTags(query) {
    if (!allProducts.length) return [];
    
    const lowerQuery = query.toLowerCase();
    const results = [];
    const tagResults = [];
    
    // First, search for exact tag matches
    const matchingTags = Array.from(allTags).filter(tag => 
        tag.toLowerCase().includes(lowerQuery)
    );
    
    // Sort tags by frequency (most common first) and relevance
    matchingTags.sort((a, b) => {
        const aScore = tagFrequency[a] || 0;
        const bScore = tagFrequency[b] || 0;
        
        // Exact match gets higher priority
        if (a === lowerQuery && b !== lowerQuery) return -1;
        if (b === lowerQuery && a !== lowerQuery) return 1;
        
        // Starts with query gets higher priority
        if (a.startsWith(lowerQuery) && !b.startsWith(lowerQuery)) return -1;
        if (b.startsWith(lowerQuery) && !a.startsWith(lowerQuery)) return 1;
        
        // Then sort by frequency
        return bScore - aScore;
    });
    
    // Take top 5 tags
    const topTags = matchingTags.slice(0, 5);
    
    // Search products
    allProducts.forEach(product => {
        let score = 0;
        const productId = product.firebaseId || product.id;
        const productTags = productTagMap[productId] || product.tags || [];
        const searchFields = [
            { field: product.name || '', weight: 10 },
            { field: product.description || '', weight: 5 },
            { field: product.brand || '', weight: 7 },
            { field: product.category || '', weight: 3 }
        ];
        
        let matchType = '';
        
        // Check each field for matches
        searchFields.forEach(({ field, weight }) => {
            const lowerField = field.toLowerCase();
            if (lowerField.includes(lowerQuery)) {
                // Higher score for exact matches at the beginning
                if (lowerField.startsWith(lowerQuery)) {
                    score += weight * 2;
                    matchType = 'name';
                } else if (lowerField.includes(lowerQuery)) {
                    score += weight;
                    matchType = 'description';
                }
            }
        });
        
        // Check tags for matches (higher weight for tag matches)
        const tagMatches = productTags.filter(tag => 
            tag.toLowerCase().includes(lowerQuery)
        );
        
        if (tagMatches.length > 0) {
            score += 15 * tagMatches.length; // Higher weight for tag matches
            matchType = 'tag';
        }
        
        if (score > 0) {
            results.push({
                ...product,
                score,
                matchType,
                tagMatches
            });
        }
    });
    
    // Sort by score (highest first)
    results.sort((a, b) => b.score - a.score);
    
    // Return both results and tags
    return {
        products: results.slice(0, 6), // Limit to 6 products
        tags: topTags
    };
}

function displaySearchResults(searchData, query) {
    const resultsDropdown = document.getElementById('searchResultsDropdown');
    const { products, tags } = searchData;
    
    if (products.length === 0 && tags.length === 0) {
        resultsDropdown.innerHTML = `
            <div class="search-no-results">
                <i class="fas fa-search"></i>
                <p>No products or tags found for "<strong>${query}</strong>"</p>
                <p style="font-size: 12px; margin-top: 5px;">Try different keywords</p>
            </div>
        `;
        resultsDropdown.classList.add('show');
        return;
    }
    
    let resultsHTML = '';
    
    // Add tag section if there are matching tags
    if (tags.length > 0) {
        resultsHTML += `
            <div class="search-tag-section">
                <div class="search-tag-title">
                    <i class="fas fa-tags"></i>
                    <span>Matching Tags</span>
                </div>
                <div class="search-tag-list">
                    ${tags.map(tag => `
                        <div class="search-tag-item" onclick="filterProductsByTag('${tag}'); clearSearch();">
                            #${tag}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    // Add product results
    if (products.length > 0) {
        products.forEach(product => {
            const category = product.category || detectCategory(product.name || '');
            const price = product.price || generatePrice(0);
            const title = product.name || generateTitle('', category);
            const imageUrl = product.mainImage || product.images?.[0]?.url || product.url || '';
            const productId = product.firebaseId || product.id;
            const productTags = productTagMap[productId] || product.tags || [];
            const matchingTags = product.tagMatches || [];
            
            // Highlight search terms in title
            const highlightedTitle = highlightText(title, query);
            
            // Apply Cloudinary transformations for thumbnail
            let displayImageUrl = imageUrl;
            if (imageUrl.includes('res.cloudinary.com')) {
                displayImageUrl = imageUrl.replace('/upload/', '/upload/w_100,h_100,c_fill/');
            }
            
            // Get match type indicator
            let matchTypeIndicator = '';
            if (product.matchType === 'tag') {
                matchTypeIndicator = '<span class="search-result-match-type">Tag Match</span>';
            } else if (product.matchType === 'name') {
                matchTypeIndicator = '<span class="search-result-match-type">Name Match</span>';
            }
            
            resultsHTML += `
                <div class="search-result-item" onclick="goToProduct('${productId}'); clearSearch();">
                    <img src="${displayImageUrl || 'https://via.placeholder.com/50x50/cccccc/ffffff?text=Product'}" 
                         alt="${title}" 
                         class="search-result-image">
                    <div class="search-result-info">
                        <div class="search-result-title">
                            ${highlightedTitle}
                            ${matchTypeIndicator}
                        </div>
                        <span class="search-result-category">${category.charAt(0).toUpperCase() + category.slice(1)}</span>
                        ${productTags.length > 0 ? `
                            <div class="search-result-tags">
                                ${productTags.slice(0, 3).map(tag => {
                                    const isMatch = matchingTags.includes(tag);
                                    return `<span class="search-result-tag" ${isMatch ? 'style="background: #667eea; color: white; border-color: #667eea;"' : ''}>#${tag}</span>`;
                                }).join('')}
                                ${productTags.length > 3 ? `<span class="search-result-tag">+${productTags.length - 3}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                    <div class="search-result-price">GHS â‚µ${price.toFixed(2)}</div>
                </div>
            `;
        });
    }
    
    resultsDropdown.innerHTML = resultsHTML;
    resultsDropdown.classList.add('show');
}

function highlightText(text, query) {
    if (!text || !query) return text;
    
    const lowerText = text.toLowerCase();
    const lowerQuery = query.toLowerCase();
    const index = lowerText.indexOf(lowerQuery);
    
    if (index === -1) return text;
    
    const before = text.substring(0, index);
    const match = text.substring(index, index + query.length);
    const after = text.substring(index + query.length);
    
    return `${before}<span class="search-result-highlight">${match}</span>${after}`;
}

function goToProduct(productId) {
    // Find the product
    const product = allProducts.find(p => 
        (p.firebaseId && p.firebaseId === productId) || 
        (p.id && p.id === productId)
    );
    
    if (product) {
        // Filter to this product's category
        const category = product.category || detectCategory(product.name || '');
        filterProductsByCategory(category);
        
        // Show notification
        setTimeout(() => {
    
            // Scroll to products section
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }, 500);
    }
}

function clearSearch() {
    const searchInput = document.getElementById('universalSearch');
    const clearBtn = document.getElementById('searchClear');
    const resultsDropdown = document.getElementById('searchResultsDropdown');
    
    searchInput.value = '';
    clearBtn.classList.remove('show');
    resultsDropdown.classList.remove('show');
    lastSearchQuery = '';
    
    // Focus back on search input
    searchInput.focus();
}

function hideSearchResults() {
    const resultsDropdown = document.getElementById('searchResultsDropdown');
    resultsDropdown.classList.remove('show');
}

// =============== INITIALIZATION ===============
// Initialize
document.addEventListener('DOMContentLoaded', () => {
    checkFirebaseConnection();
    updateCartCount();
    
    // Refresh products when coming from admin page
    if (localStorage.getItem('refresh_products')) {
        loadProductsFromFirebase();
        localStorage.removeItem('refresh_products');
        
        setTimeout(() => {
        }, 1000);
    }
    
    const adminLinks = document.querySelectorAll('a[href="upload.html"]');
    adminLinks.forEach(link => {
        link.addEventListener('click', () => {
            localStorage.setItem('refresh_products', 'true');
        });
    });
    
    // Mobile menu
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('show');
        });
    }
    
    // Add search input focus effect
    const searchInput = document.getElementById('universalSearch');
    if (searchInput) {
        searchInput.addEventListener('focus', () => {
            if (searchInput.value.trim().length >= 2) {
                performSearch(searchInput.value.trim());
            }
        });
    }
    
    // Close search results when clicking outside
    document.addEventListener('click', (event) => {
        const searchContainer = document.querySelector('.search-container');
        const searchResults = document.getElementById('searchResultsDropdown');
        
        if (searchResults && searchResults.classList.contains('show') && 
            !searchContainer.contains(event.target)) {
            hideSearchResults();
        }
    });
});

// Make functions available globally
window.addToCart = addToCart;
window.loadProductsFromFirebase = loadProductsFromFirebase;
window.filterProducts = filterProducts;
window.filterProductsByCategory = filterProductsByCategory;
window.filterProductsByTag = filterProductsByTag;
window.clearSearch = clearSearch;
window.handleSearch = handleSearch;
window.testNotificationSystem = testNotificationSystem;

// =============== SHOPPING CART COMPLETE IMPLEMENTATION ===============
// Cart state
// DOM Elements
const cartBtn = document.getElementById('cartBtn');
const cartModal = document.getElementById('cartModal');
const closeCart = document.getElementById('closeCart');
const cartItems = document.getElementById('cartItems');
const cartCount = document.getElementById('cartCount');
const cartSubtotal = document.getElementById('cartSubtotal');
const cartTotal = document.getElementById('cartTotal');
const checkoutBtn = document.querySelector('.btn-checkout');

// Cart initialization
function initCart() {
    updateCartCount();
    setupCartEventListeners();
    renderCartItems(); // Initial render
    
    // Add clear cart button to cart modal
    addClearCartButton();
    
    console.log('Cart initialized with', cart.length, 'items');
}

// Setup all cart event listeners
function setupCartEventListeners() {
    // Cart button click
    if (cartBtn) {
        cartBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openCart();
        });
    }
    
    // Close cart button
    if (closeCart) {
        closeCart.addEventListener('click', closeCartModal);
    }
    
    // Close cart when clicking outside
    if (cartModal) {
        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                closeCartModal();
            }
        });
    }
    
    // Checkout button
    if (checkoutBtn) {
        checkoutBtn.addEventListener('click', proceedToCheckout);
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && cartModal.style.display === 'flex') {
            closeCartModal();
        }
    });
    
    // Listen for cart updates from other parts of the app
    document.addEventListener('cartUpdated', () => {
        updateCartCount();
        if (cartModal.style.display === 'flex') {
            renderCartItems();
        }
    });
}

// Add clear cart button to cart header
function addClearCartButton() {
    const cartHeader = document.querySelector('.cart-header');
    if (cartHeader && !document.querySelector('.clear-cart-btn')) {
        const clearBtn = document.createElement('button');
        clearBtn.className = 'clear-cart-btn';
        clearBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Clear';
        clearBtn.onclick = clearCart;
        cartHeader.appendChild(clearBtn);
    }
}

// Open cart modal
function openCart() {
    renderCartItems();
    cartModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    document.body.style.paddingRight = getScrollbarWidth() + 'px'; // Prevent layout shift
}

// Close cart modal
function closeCartModal() {
    cartModal.style.display = 'none';
    document.body.style.overflow = 'auto';
    document.body.style.paddingRight = '0';
}

// Get scrollbar width to prevent layout shift
function getScrollbarWidth() {
    return window.innerWidth - document.documentElement.clientWidth;
}

// Enhanced add to cart function
function addToCart(title, price, image, description = '', productId = null, category = null) {
    // Generate a unique ID if productId not provided
    const id = productId || `prod_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    
    // Check if item already exists in cart
    const existingItemIndex = cart.findIndex(item => 
        item.id === id || (item.title === title && item.price === parseFloat(price))
    );
    
    if (existingItemIndex !== -1) {
        // Update quantity if item exists
        cart[existingItemIndex].quantity += 1;
    } else {
        // Add new item with enhanced data
        cart.push({
            id,
            title,
            price: parseFloat(price),
            image,
            description,
            quantity: 1,
            category: category || 'general',
            addedAt: new Date().toISOString(),
            inStock: true
        });
        
        // Add animation to cart icon
        animateCartIcon();
    }
    
    // Save to localStorage
    saveCart();
    
    // Update UI
    updateCartCount();
    
    // If cart is open, refresh the display
    if (cartModal.style.display === 'flex') {
        renderCartItems();
    }
    
    // Trigger cart updated event
    document.dispatchEvent(new Event('cartUpdated'));
    
    return cart.length;
}

// Remove item from cart
function removeFromCart(itemId, showNotification = true) {
    const item = cart.find(item => item.id === itemId);
    cart = cart.filter(item => item.id !== itemId);
    
    saveCart();
    updateCartCount();
    
    if (cartModal.style.display === 'flex') {
        renderCartItems();
    }
    
    if (showNotification && item) {
        showNotification(`<i class="fas fa-trash"></i> Removed "${item.title}" from cart`, 'info');
    }
    
    document.dispatchEvent(new Event('cartUpdated'));
}

// Update item quantity
function updateQuantity(itemId, newQuantity) {
    if (newQuantity < 1) {
        removeFromCart(itemId, false);
        return;
    }
    
    const itemIndex = cart.findIndex(item => item.id === itemId);
    if (itemIndex !== -1) {
        cart[itemIndex].quantity = parseInt(newQuantity);
        saveCart();
        
        if (cartModal.style.display === 'flex') {
            renderCartItems();
        }
        
        updateCartCount();
        document.dispatchEvent(new Event('cartUpdated'));
    }
}

// Save cart to localStorage
function saveCart() {
    localStorage.setItem('kindadys_cart', JSON.stringify(cart));
}

// Calculate cart totals (updated for Ghana - NO FREE DELIVERY)
function calculateCartTotals() {
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const delivery = 50.00; // Fixed delivery fee, NO FREE DELIVERY
    const total = subtotal + delivery;
    const itemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
    
    return {
        subtotal: subtotal.toFixed(2),
        delivery: delivery.toFixed(2),
        total: total.toFixed(2),
        itemCount: itemCount,
        deliveryMessage: `GHS â‚µ${delivery.toFixed(2)}`
    };
}

// Render cart items
function renderCartItems() {
    if (!cartItems) return;
    
    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="empty-cart">
                <i class="fas fa-shopping-bag"></i>
                <h4>Your Shopping Bag is Empty</h4>
                <p>Add some beautiful products to get started</p>
                <button class="btn btn-primary" onclick="closeCartModal(); document.getElementById('products').scrollIntoView({behavior: 'smooth'})">
                    <i class="fas fa-store"></i> Continue Shopping
                </button>
            </div>
        `;
        
        updateCartTotalsDisplay();
        return;
    }
    
    // Calculate totals
    const totals = calculateCartTotals();
    
    // Update totals display
    updateCartTotalsDisplay(totals);
    
    // Render cart items
    const itemsHTML = cart.map((item, index) => {
        const itemTotal = (item.price * item.quantity).toFixed(2);
        
        return `
            <div class="cart-item" data-id="${item.id}">
                <div class="cart-item-image">
                    <img src="${item.image || 'https://via.placeholder.com/100x100/cccccc/ffffff?text=Product'}" 
                         alt="${item.title}"
                         loading="lazy">
                    ${item.quantity > 1 ? `<span class="quantity-badge">${item.quantity}</span>` : ''}
                </div>
                <div class="cart-item-details">
                    <div class="cart-item-header">
                        <h4 class="cart-item-title">${item.title}</h4>
                        <span class="cart-item-category">${item.category || 'General'}</span>
                    </div>
                    ${item.description ? `<p class="cart-item-desc">${truncateText(item.description, 60)}</p>` : ''}
                    <p class="cart-item-price">GHS â‚µ${item.price.toFixed(2)} each</p>
                    <div class="cart-item-quantity">
                        <button class="quantity-btn minus" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" 
                               class="quantity-input" 
                               value="${item.quantity}" 
                               min="1" 
                               max="99"
                               onchange="updateQuantity('${item.id}', this.value)"
                               onblur="validateQuantity('${item.id}', this.value)">
                        <button class="quantity-btn plus" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="cart-item-actions">
                    <button class="remove-item" onclick="removeFromCart('${item.id}')" title="Remove item">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="cart-item-total">
                        GHS â‚µ${itemTotal}
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    // Delivery notice (NO free delivery)
    const deliveryNotice = `
        <div class="delivery-notice">
            <div class="notice-text">
                <i class="fas fa-truck"></i>
                <span>Delivery fee: GHS â‚µ50.00 applies to all orders</span>
            </div>
        </div>
    `;
    
    cartItems.innerHTML = deliveryNotice + itemsHTML;
}

// Update cart totals display
function updateCartTotalsDisplay(totals = null) {
    if (!totals) {
        totals = {
            subtotal: '0.00',
            total: '0.00',
            deliveryMessage: 'GHS â‚µ50.00'
        };
    }
    
    if (cartSubtotal) cartSubtotal.textContent = totals.subtotal;
    if (cartTotal) cartTotal.textContent = totals.total;
    if (document.getElementById('shippingCost')) {
        document.getElementById('shippingCost').textContent = totals.deliveryMessage;
    }
}

// Update cart count badge
function updateCartCount() {
    if (!cartCount) return;
    
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCount.textContent = totalItems > 99 ? '99+' : totalItems.toString();
    
    // Show/hide badge based on count
    if (totalItems > 0) {
        cartCount.style.display = 'flex';
    } else {
        cartCount.style.display = 'none';
    }
}

// Validate quantity input
function validateQuantity(itemId, value) {
    const quantity = parseInt(value);
    if (isNaN(quantity) || quantity < 1) {
        updateQuantity(itemId, 1);
    } else if (quantity > 99) {
        updateQuantity(itemId, 99);
    }
}

// Proceed to checkout
function proceedToCheckout() {
    if (cart.length === 0) {
        showNotification('<i class="fas fa-exclamation-circle"></i> Your cart is empty! Add items to checkout.', 'warning');
        return;
    }
    
    // Create order summary
    const orderSummary = {
        items: cart,
        totals: calculateCartTotals(),
        orderId: 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
        date: new Date().toISOString(),
        status: 'pending',
        paymentStatus: 'pending'
    };
    
    // Save order to localStorage (temporary)
    localStorage.setItem('kindadys_last_order', JSON.stringify(orderSummary));
    
    // Show checkout modal
    showCheckoutModal(orderSummary);
}

// Show checkout modal
function showCheckoutModal(orderSummary) {
    const modalHTML = `
        <div class="checkout-modal" id="checkoutModal">
            <div class="checkout-content">
                <div class="checkout-header">
                    <h3><i class="fas fa-lock"></i> Complete Your Order</h3>
                    <button class="close-checkout" onclick="closeCheckoutModal()">&times;</button>
                </div>
                <div class="checkout-body">
                    <div class="order-summary">
                        <h4>Order Summary</h4>
                        <div class="order-items">
                            ${orderSummary.items.map(item => `
                                <div class="order-item">
                                    <span>${item.title} Ã— ${item.quantity}</span>
                                    <span>GHS â‚µ${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="order-totals">
                            <div class="order-total-line">
                                <span>Subtotal:</span>
                                <span>GHS â‚µ${orderSummary.totals.subtotal}</span>
                            </div>
                            <div class="order-total-line">
                                <span>Delivery:</span>
                                <span>GHS â‚µ${orderSummary.totals.delivery}</span>
                            </div>
                            <div class="order-total-line grand-total">
                                <span>Total:</span>
                                <span>GHS â‚µ${orderSummary.totals.total}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="checkout-form">
                        <h4>Delivery Information</h4>
                        <div class="form-group">
                            <label for="checkoutName">Full Name *</label>
                            <input type="text" id="checkoutName" placeholder="Full Name" required>
                        </div>
                        <div class="form-group">
                            <label for="checkoutEmail">Email Address (Optional)</label>
                            <input type="email" id="checkoutEmail" placeholder="Email Address (Optional)">
                            <small class="form-hint">Optional - for order updates and receipts</small>
                        </div>
                        <div class="form-group">
                            <label for="checkoutPhone">Phone Number *</label>
                            <input type="tel" id="checkoutPhone" placeholder="e.g., 0551234567 (Start with 0)" required pattern="0[0-9]{9}">
                            <small class="form-hint">Enter your 10-digit Ghana phone number (starting with 0)</small>
                        </div>
                        <div class="form-group">
                            <label for="checkoutAddress">Delivery Address *</label>
                            <textarea id="checkoutAddress" placeholder="Full Delivery Address (House number, Street, Landmark)" rows="3" required></textarea>
                        </div>
                        <div class="delivery-fee-notice">
                            <i class="fas fa-exclamation-circle"></i>
                            <span><strong>Note:</strong> Delivery fee is not fixed and varies by region. We'll contact you with the exact fee after order confirmation.</span>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="checkoutCity">City/Town *</label>
                                <input type="text" id="checkoutCity" placeholder="City/Town" required>
                            </div>
                            <div class="form-group">
                                <label for="checkoutRegion">Region *</label>
                                <select id="checkoutRegion" class="form-control" required>
                                    <option value="">Select Region</option>
                                    <option value="Greater Accra">Greater Accra</option>
                                    <option value="Ashanti">Ashanti</option>
                                    <option value="Western">Western</option>
                                    <option value="Western North">Western North</option>
                                    <option value="Central">Central</option>
                                    <option value="Eastern">Eastern</option>
                                    <option value="Volta">Volta</option>
                                    <option value="Oti">Oti</option>
                                    <option value="Northern">Northern</option>
                                    <option value="North East">North East</option>
                                    <option value="Savannah">Savannah</option>
                                    <option value="Upper East">Upper East</option>
                                    <option value="Upper West">Upper West</option>
                                    <option value="Bono">Bono</option>
                                    <option value="Bono East">Bono East</option>
                                    <option value="Ahafo">Ahafo</option>
                                </select>
                            </div>
                        </div>
                        
                        <h4>Payment Method</h4>
                        <div class="form-group">
                            <label for="checkoutPayment">Select Payment Method *</label>
                            <select id="checkoutPayment" class="form-control" required>
                                <option value="">Select Payment Method</option>
                                <option value="mobile_money">Mobile Money</option>
                                <option value="cash_on_delivery">Cash on Delivery</option>
                                <option value="bank_transfer">Bank Transfer</option>
                            </select>
                        </div>
                        
                        <div id="paymentDetails">
                            <!-- Payment details will be shown based on selection -->
                        </div>
                        
                       <div class="form-group">
    <label class="checkbox-label tiny-checkbox">
        <input type="checkbox" id="termsAgreement" required style="width: 14px; height: 14px; margin-right: 8px;">
        <span style="font-size: 12px; line-height: 1.3;">I agree to the Terms & Conditions and understand that delivery fee applies to all orders</span>
    </label>
</div>
                        <div class="checkout-actions">
                            <button class="btn btn-secondary" onclick="closeCheckoutModal()">
                                <i class="fas fa-arrow-left"></i> Back to Cart
                            </button>
                            <button class="btn btn-success" onclick="processPayment()">
                                <i class="fas fa-check-circle"></i> Place Order
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing checkout modal if any
    const existingModal = document.getElementById('checkoutModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to page
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Show modal
    setTimeout(() => {
        document.getElementById('checkoutModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }, 10);
    
    // Close cart modal
    closeCartModal();
    
    // Add payment method change listener
    document.getElementById('checkoutPayment').addEventListener('change', function() {
        updatePaymentDetails(this.value);
    });
}

// Update payment details based on selected method
function updatePaymentDetails(paymentMethod) {
    const paymentDetails = document.getElementById('paymentDetails');
    
    switch(paymentMethod) {
        case 'mobile_money':
            paymentDetails.innerHTML = `
                <div class="form-group">
                    <label for="mobileMoneyProvider">Mobile Money Provider *</label>
                    <select id="mobileMoneyProvider" class="form-control" required>
                        <option value="">Select Provider</option>
                        <option value="mtn">MTN Mobile Money</option>
                        <option value="vodafone">Vodafone Cash</option>
                        <option value="airteltigo">AirtelTigo Money</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="mobileMoneyNumber">Your Mobile Money Number *</label>
                    <input type="tel" 
                           id="mobileMoneyNumber" 
                           placeholder="e.g., 0551234567 (Start with 0)" 
                           required 
                           pattern="0[0-9]{9}">
                    <small class="form-hint">Enter your 10-digit Ghana mobile money number (starting with 0)</small>
                </div>
                <div class="payment-instructions">
                    <h5><i class="fas fa-info-circle"></i> Payment Instructions:</h5>
                    <ol class="instructions-list">
                        <li>Send payment to: <strong>0595736002</strong></li>
                        <li>Reference: Use your <strong>Order ID</strong> or <strong>Phone Number</strong></li>
                        <li>After payment, send the transaction screenshot to: <strong>0595736002</strong></li>
                    </ol>
                    <div class="seller-contact">
                        <p><i class="fas fa-phone"></i> <strong>Seller Contact:</strong> 0595736002</p>
                        <p class="call-notice"><i class="fas fa-phone-volume"></i> Please call this number for order confirmation and inquiries</p>
                    </div>
                </div>
            `;
            break;
        case 'cash_on_delivery':
            paymentDetails.innerHTML = `
                <div class="form-group">
                    <div class="payment-info">
                        <p><strong>Cash on Delivery Instructions:</strong></p>
                        <p>You will pay cash when your order is delivered.</p>
                        <p>Delivery fee will be calculated based on your region and will be communicated before delivery.</p>
                        <div class="seller-contact">
                            <p><i class="fas fa-phone"></i> <strong>Seller Contact:</strong> 0595736002</p>
                            <p class="call-notice"><i class="fas fa-phone-volume"></i> Please call this number for delivery fee confirmation</p>
                        </div>
                    </div>
                </div>
            `;
            break;
        case 'bank_transfer':
            paymentDetails.innerHTML = `
                <div class="form-group">
                    <p class="payment-info"><strong>Bank Transfer Details:</strong></p>
                    <p><strong>Bank:</strong> To be communicated after order</p>
                    <p><strong>Account Name:</strong> Kindady's E-tail</p>
                    <div class="seller-contact">
                        <p><i class="fas fa-phone"></i> <strong>Contact for details:</strong> 0595736002</p>
                        <p>After payment, send proof to: <strong>0595736002</strong></p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transferReference">Transfer Reference *</label>
                    <input type="text" id="transferReference" placeholder="Transfer Reference" required>
                    <small class="form-hint">Enter the reference number from your bank transfer</small>
                </div>
            `;
            break;
        default:
            paymentDetails.innerHTML = '';
    }
}

// Close checkout modal
function closeCheckoutModal() {
    const checkoutModal = document.getElementById('checkoutModal');
    if (checkoutModal) {
        checkoutModal.style.display = 'none';
        checkoutModal.remove();
        document.body.style.overflow = 'auto';
    }
}

// Get payment details based on method
function getPaymentDetails(paymentMethod) {
    switch(paymentMethod) {
        case 'mobile_money':
            const provider = document.getElementById('mobileMoneyProvider')?.value || '';
            const number = document.getElementById('mobileMoneyNumber')?.value || '';
            return {
                provider: provider,
                number: number,
                instructions: `Send payment to 0595736002 and send screenshot proof to the same number`
            };
        case 'bank_transfer':
            const reference = document.getElementById('transferReference')?.value || '';
            return {
                reference: reference,
                instructions: 'Kindly use the reference when making payment and send proof to 0595736002'
            };
        case 'cash_on_delivery':
            return {
                instructions: 'Pay cash on delivery. Delivery fee will be communicated before delivery.'
            };
        default:
            return {};
    }
}

// Show order confirmation page
function showOrderConfirmation(orderData, orderNumber, firebaseId) {
    const confirmationHTML = `
        <div class="order-confirmation-modal" id="orderConfirmationModal">
            <div class="confirmation-content">
                <div class="confirmation-header">
                    <i class="fas fa-check-circle"></i>
                    <h3>Thank You for Your Order!</h3>
                    <p>Order #${orderNumber}</p>
                </div>
                <div class="confirmation-body">
                    <div class="confirmation-details">
                        <div class="detail-section">
                            <h4><i class="fas fa-user"></i> Customer Information</h4>
                            <p><strong>Name:</strong> ${orderData.customer.name}</p>
                            <p><strong>Phone:</strong> ${orderData.customer.phone}</p>
                            <p><strong>Address:</strong> ${orderData.customer.address}, ${orderData.customer.city}, ${orderData.customer.region}</p>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-receipt"></i> Order Summary</h4>
                            <div class="order-items-list">
                                ${orderData.orderDetails.items.map(item => `
                                    <div class="confirmation-item">
                                        <span>${item.title} Ã— ${item.quantity}</span>
                                        <span>GHS â‚µ${(item.price * item.quantity).toFixed(2)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="confirmation-totals">
                                <div class="confirmation-total-line">
                                    <span>Subtotal:</span>
                                    <span>GHS â‚µ${orderData.orderDetails.subtotal.toFixed(2)}</span>
                                </div>
                                <div class="confirmation-total-line">
                                    <span>Delivery:</span>
                                    <span>GHS â‚µ${orderData.orderDetails.delivery.toFixed(2)}</span>
                                </div>
                                <div class="confirmation-total-line grand-total">
                                    <span>Total:</span>
                                    <span>GHS â‚µ${orderData.orderDetails.total.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-credit-card"></i> Payment Information</h4>
                            <p><strong>Method:</strong> ${formatPaymentMethod(orderData.payment.method)}</p>
                            <p><strong>Status:</strong> <span class="status-badge ${orderData.payment.status}">${formatPaymentStatus(orderData.payment.status)}</span></p>
                            ${getPaymentInstructions(orderData.payment)}
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-store"></i> Seller Information</h4>
                            <p><i class="fas fa-phone"></i> <strong>Contact Number:</strong> 0595736002</p>
                            <p><i class="fas fa-money-bill-wave"></i> <strong>Payment Number:</strong> 0595736002</p>
                            <div class="call-reminder">
                                <i class="fas fa-phone-volume"></i>
                                <strong>Call for:</strong> Order confirmation, delivery fee details, and inquiries
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4><i class="fas fa-info-circle"></i> Next Steps</h4>
                            <ul class="next-steps">
                                <li><i class="fas fa-check"></i> Order confirmed and received</li>
                                <li><i class="fas fa-phone"></i> We'll contact you within 24 hours for payment confirmation</li>
                                <li><i class="fas fa-truck"></i> Delivery in 3-5 business days after payment confirmation</li>
                                <li><i class="fas fa-mobile-alt"></i> Contact: 0595736002 for any questions</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="confirmation-actions">
                        <button class="btn btn-primary" onclick="continueShopping()">
                            <i class="fas fa-store"></i> Continue Shopping
                        </button>
                        <button class="btn btn-secondary" onclick="printOrder()">
                            <i class="fas fa-print"></i> Print Order
                        </button>
                        <button class="btn btn-outline" onclick="closeConfirmationModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    
                    <div class="confirmation-footer">
                        <p><i class="fas fa-shield-alt"></i> Order ID: ${firebaseId}</p>
                        <p><i class="fas fa-phone"></i> Need help? Call: 0595736002</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('orderConfirmationModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to page
    document.body.insertAdjacentHTML('beforeend', confirmationHTML);
    
    // Show modal
    setTimeout(() => {
        document.getElementById('orderConfirmationModal').style.display = 'flex';
    }, 10);
}

// Get payment instructions
function getPaymentInstructions(payment) {
    if (payment.method === 'mobile_money') {
        return `
            <p><strong>Payment Instructions:</strong></p>
            <p>1. Send payment to: <strong>0595736002</strong></p>
            <p>2. Reference: Use your <strong>Order ID</strong> or <strong>Phone Number</strong></p>
            <p>3. Send payment screenshot to: <strong>0595736002</strong></p>
        `;
    } else if (payment.method === 'bank_transfer') {
        return `
            <p><strong>Payment Instructions:</strong></p>
            <p>1. Wait for bank details from seller</p>
            <p>2. Send payment proof to: <strong>0595736002</strong></p>
        `;
    } else if (payment.method === 'cash_on_delivery') {
        return `
            <p><strong>Payment Instructions:</strong></p>
            <p>Pay cash when your order is delivered</p>
            <p>Delivery fee will be communicated before delivery</p>
            <p>Please have exact change ready</p>
        `;
    }
    return '';
}

// Continue shopping after purchase
function continueShopping() {
    const confirmationModal = document.getElementById('orderConfirmationModal');
    if (confirmationModal) {
        confirmationModal.remove();
    }
    
    // Scroll to products
    document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
}

// Close confirmation modal
function closeConfirmationModal() {
    const confirmationModal = document.getElementById('orderConfirmationModal');
    if (confirmationModal) {
        confirmationModal.style.display = 'none';
        confirmationModal.remove();
    }
}

// Print order
function printOrder() {
    window.print();
}

// Clear entire cart
function clearCart(showConfirm = true) {
    if (showConfirm) {
        if (!confirm('Are you sure you want to clear your cart? This cannot be undone.')) {
            return;
        }
    }
    
    cart = [];
    saveCart();
    updateCartCount();
    renderCartItems();
    
    if (showConfirm) {
        showNotification('<i class="fas fa-trash-alt"></i> Cart cleared', 'info');
    }
    
    document.dispatchEvent(new Event('cartUpdated'));
}

// Get cart items (public API)
function getCartItems() {
    return [...cart]; // Return a copy
}

// Get cart total (public API)
function getCartTotal() {
    const totals = calculateCartTotals();
    return parseFloat(totals.total);
}

// Get item count (public API)
function getCartItemCount() {
    return cart.reduce((sum, item) => sum + item.quantity, 0);
}

// Animate cart icon when item is added
function animateCartIcon() {
    const cartIcon = document.querySelector('.cart-icon a');
    if (cartIcon) {
        cartIcon.style.transform = 'scale(1.2)';
        setTimeout(() => {
            cartIcon.style.transform = 'scale(1)';
        }, 300);
    }
}

// Enhanced notification system
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    if (!notification) return;
    
    // Set type-based styling
    const typeClasses = {
        success: 'notification-success',
        error: 'notification-error',
        warning: 'notification-warning',
        info: 'notification-info'
    };
    
    // Remove existing type classes
    notification.classList.remove('notification-success', 'notification-error', 'notification-warning', 'notification-info');
    
    // Add new type class
    notification.classList.add(typeClasses[type] || 'notification-success');
    
    // Set message
    notification.innerHTML = message;
    notification.classList.add('show');
    
    // Auto-hide
    const hideTimeout = setTimeout(() => {
        notification.classList.remove('show');
    }, 5000);
    
    // Allow manual dismissal
    notification.onclick = () => {
        clearTimeout(hideTimeout);
        notification.classList.remove('show');
    };
}

// Utility function to truncate text
function truncateText(text, maxLength) {
    if (!text) return '';
    return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
}

// =============== UPDATE PRODUCT CARD BUTTONS ===============
// Function to update all product card buttons
function updateProductCardButtons() {
    // Update existing buttons
    document.querySelectorAll('.add-to-cart').forEach(button => {
        const productCard = button.closest('.product-card');
        if (productCard) {
            const title = productCard.querySelector('.product-title')?.textContent || '';
            const priceText = productCard.querySelector('.product-price')?.textContent || 'GHS â‚µ0';
            const price = parseFloat(priceText.replace(/[^0-9.-]+/g, ''));
            const image = productCard.querySelector('.product-image')?.src || '';
            const description = productCard.querySelector('p')?.textContent || '';
            const productId = productCard.dataset.firebaseId || productCard.dataset.id || '';
            const category = productCard.dataset.category || '';
            
            // Update onclick handler
            button.setAttribute('onclick', `addToCart('${title.replace(/'/g, "\\'")}', ${price}, '${image}', '${description.replace(/'/g, "\\'")}', '${productId}', '${category}')`);
        }
    });
}

// Monitor for dynamically added product cards
function setupProductCardObserver() {
    const observer = new MutationObserver((mutations) => {
        let shouldUpdate = false;
        
        mutations.forEach((mutation) => {
            if (mutation.addedNodes.length) {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1) { // Element node
                        if (node.classList?.contains('product-card') || 
                            node.querySelector?.('.product-card') ||
                            node.querySelector?.('.add-to-cart')) {
                            shouldUpdate = true;
                        }
                    }
                });
            }
        });
        
        if (shouldUpdate) {
            setTimeout(updateProductCardButtons, 100);
        }
    });
    
    // Start observing the products grid
    const productsGrid = document.getElementById('productsGrid');
    if (productsGrid) {
        observer.observe(productsGrid, {
            childList: true,
            subtree: true
        });
    }
}

// =============== STYLES ===============
// Inject cart styles into the page
const cartStyles = `
    /* Cart Modal Styles */
    .cart-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: flex-end;
        justify-content: flex-end;
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .cart-content {
        width: 100%;
        max-width: 480px;
        height: 100%;
        background: white;
        display: flex;
        flex-direction: column;
        animation: slideIn 0.3s ease;
        box-shadow: -5px 0 30px rgba(0,0,0,0.1);
    }
    
    @keyframes slideIn {
        from { transform: translateX(100%); }
        to { transform: translateX(0); }
    }
    
    .cart-header {
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #1a365d;
        color: white;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .cart-header h3 {
        margin: 0;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .close-cart {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.3s;
    }
    
    .close-cart:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .clear-cart-btn {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.3);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s;
    }
    
    .clear-cart-btn:hover {
        background: rgba(239, 68, 68, 0.8);
        border-color: rgba(239, 68, 68, 0.8);
    }
    
    .cart-items {
        flex: 1;
        overflow-y: auto;
        padding: 0;
    }
    
    /* Delivery Notice */
    .delivery-notice {
        padding: 15px 20px;
        background: #f0fdf4;
        border-bottom: 1px solid #bbf7d0;
        color: #065f46;
    }
    
    .notice-text {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        font-weight: 500;
    }
    
    .notice-text i {
        color: #10b981;
    }
    
    /* Cart Item Styles */
    .cart-item {
        display: flex;
        gap: 15px;
        padding: 20px;
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.3s;
        animation: fadeInUp 0.3s ease;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .cart-item:hover {
        background: #f9fafb;
    }
    
    .cart-item-image {
        width: 100px;
        height: 100px;
        flex-shrink: 0;
        position: relative;
    }
    
    .cart-item-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
    }
    
    .quantity-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #ed64a6;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        border: 2px solid white;
    }
    
    .cart-item-details {
        flex: 1;
        min-width: 0;
    }
    
    .cart-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 5px;
    }
    
    .cart-item-title {
        margin: 0;
        font-size: 15px;
        font-weight: 600;
        color: #1f2937;
        line-height: 1.4;
    }
    
    .cart-item-category {
        font-size: 11px;
        color: #6b7280;
        background: #f3f4f6;
        padding: 2px 8px;
        border-radius: 12px;
        white-space: nowrap;
    }
    
    .cart-item-desc {
        margin: 5px 0 8px 0;
        font-size: 13px;
        color: #6b7280;
        line-height: 1.4;
    }
    
    .cart-item-price {
        margin: 0 0 12px 0;
        font-size: 14px;
        font-weight: 600;
        color: #ed64a6;
    }
    
    .cart-item-quantity {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .quantity-btn {
        width: 32px;
        height: 32px;
        border: 1px solid #d1d5db;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: #4b5563;
        transition: all 0.3s;
    }
    
    .quantity-btn:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
    }
    
    .quantity-btn:active {
        transform: scale(0.95);
    }
    
    .quantity-input {
        width: 60px;
        height: 32px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        text-align: center;
        font-size: 14px;
        font-weight: 600;
        font-family: 'Poppins', sans-serif;
        transition: border 0.3s;
    }
    
    .quantity-input:focus {
        outline: none;
        border-color: #ed64a6;
    }
    
    .cart-item-actions {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        justify-content: space-between;
    }
    
    .remove-item {
        background: #fee2e2;
        border: none;
        color: #ef4444;
        cursor: pointer;
        font-size: 14px;
        padding: 8px;
        border-radius: 6px;
        transition: all 0.3s;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .remove-item:hover {
        background: #fecaca;
        transform: rotate(90deg);
    }
    
    .cart-item-total {
        font-weight: 700;
        font-size: 16px;
        color: #1a365d;
        text-align: right;
    }
    
    /* Cart Total Styles */
    .cart-total {
        padding: 20px;
        border-top: 1px solid #e5e7eb;
        background: #f9fafb;
        position: sticky;
        bottom: 0;
    }
    
    .total-line {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 14px;
        color: #4b5563;
    }
    
    .total-line.grand-total {
        font-size: 18px;
        font-weight: 700;
        color: #1f2937;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e5e7eb;
    }
    
    .btn-checkout {
        width: 100%;
        margin-top: 20px;
        background: linear-gradient(135deg, #ed64a6 0%, #667eea 100%);
        color: white;
        border: none;
        padding: 16px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    
    .btn-checkout:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(237, 100, 166, 0.3);
    }
    
    .btn-checkout:active {
        transform: translateY(0);
    }
    
    .continue-shopping {
        text-align: center;
        margin-top: 15px;
        font-size: 14px;
        color: #6b7280;
    }
    
    .continue-shopping a {
        color: #ed64a6;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }
    
    .continue-shopping a:hover {
        text-decoration: underline;
        color: #667eea;
    }
    
    /* Empty Cart State */
    .empty-cart {
        text-align: center;
        padding: 60px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
    }
    
    .empty-cart i {
        font-size: 64px;
        color: #d1d5db;
        margin-bottom: 20px;
    }
    
    .empty-cart h4 {
        margin: 0 0 10px 0;
        color: #374151;
        font-size: 20px;
    }
    
    .empty-cart p {
        color: #6b7280;
        margin-bottom: 25px;
        max-width: 300px;
        line-height: 1.6;
    }
    
    /* Cart Icon */
    .cart-icon {
        position: relative;
    }
    
    .cart-icon a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: rgba(237, 100, 166, 0.1);
        color: #ed64a6;
        text-decoration: none;
        transition: all 0.3s;
        position: relative;
    }
    
    .cart-icon a:hover {
        background: rgba(237, 100, 166, 0.2);
        transform: translateY(-2px);
    }
    
    .cart-count {
        background: linear-gradient(135deg, #ed64a6 0%, #667eea 100%);
        color: white;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
        position: absolute;
        top: -5px;
        right: -5px;
        border: 2px solid white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    /* Checkout Modal */
    .checkout-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 3000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .checkout-content {
        width: 100%;
        max-width: 800px;
        max-height: 90vh;
        background: white;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        animation: scaleIn 0.3s ease;
        overflow: hidden;
    }
    
    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    .checkout-header {
        padding: 20px 30px;
        background: #1a365d;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .checkout-header h3 {
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .close-checkout {
        background: none;
        border: none;
        color: white;
        font-size: 28px;
        cursor: pointer;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.3s;
    }
    
    .close-checkout:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .checkout-body {
        display: flex;
        flex: 1;
        overflow: hidden;
    }
    
    .order-summary {
        flex: 1;
        padding: 30px;
        background: #f9fafb;
        overflow-y: auto;
    }
    
    .checkout-form {
        flex: 1.5;
        padding: 30px;
        overflow-y: auto;
    }
    
    .checkout-form h4 {
        margin-top: 0;
        margin-bottom: 20px;
        color: #1a365d;
        font-size: 18px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
    }
    
    .checkout-form input, .checkout-form select, .checkout-form textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-family: 'Poppins', sans-serif;
        font-size: 14px;
        transition: all 0.3s;
    }
    
    .checkout-form input:focus, .checkout-form select:focus, .checkout-form textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .checkout-form input::placeholder, .checkout-form textarea::placeholder {
        color: #9ca3af;
    }
    
    .form-hint {
        display: block;
        margin-top: 5px;
        font-size: 12px;
        color: #6b7280;
    }
    
    .checkbox-label {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        font-size: 14px;
        color: #4b5563;
        cursor: pointer;
    }
    
    .checkbox-label input[type="checkbox"] {
        margin-top: 3px;
        flex-shrink: 0;
    }
    
    .payment-info {
        background: #f8fafc;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        font-size: 14px;
        color: #4b5563;
    }
    
    .payment-info p {
        margin: 5px 0;
    }
    
    .checkout-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }
    
    .checkout-actions .btn {
        flex: 1;
        padding: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .btn-success {
        background: #10b981;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-success:hover {
        background: #059669;
        transform: translateY(-2px);
    }
    
    /* Order Summary in Checkout */
    .order-items {
        margin-bottom: 25px;
    }
    
    .order-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e5e7eb;
        font-size: 14px;
    }
    
    .order-item:last-child {
        border-bottom: none;
    }
    
    .order-totals {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
    }
    
    .order-total-line {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 15px;
    }
    
    .order-total-line.grand-total {
        font-size: 18px;
        font-weight: 700;
        color: #1f2937;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e5e7eb;
    }
    
    /* Order Confirmation Modal */
    .order-confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 4000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .confirmation-content {
        width: 100%;
        max-width: 800px;
        max-height: 90vh;
        background: white;
        border-radius: 15px;
        overflow: hidden;
        animation: slideUp 0.5s ease;
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .confirmation-header {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 40px 30px;
        text-align: center;
    }
    
    .confirmation-header i {
        font-size: 64px;
        margin-bottom: 20px;
    }
    
    .confirmation-header h3 {
        margin: 0 0 10px 0;
        font-size: 24px;
    }
    
    .confirmation-header p {
        margin: 0;
        opacity: 0.9;
        font-size: 18px;
    }
    
    .confirmation-body {
        padding: 30px;
        overflow-y: auto;
        max-height: 70vh;
    }
    
    .confirmation-details {
        display: grid;
        gap: 25px;
        margin-bottom: 30px;
    }
    
    .detail-section {
        background: #f9fafb;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #667eea;
    }
    
    .detail-section h4 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #1a365d;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .detail-section p {
        margin: 8px 0;
        color: #4b5563;
        line-height: 1.5;
    }
    
    .confirmation-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e5e7eb;
        font-size: 14px;
    }
    
    .confirmation-totals {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e5e7eb;
    }
    
    .confirmation-total-line {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 15px;
    }
    
    .confirmation-total-line.grand-total {
        font-size: 18px;
        font-weight: 700;
        color: #1f2937;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
    }
    
    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .status-badge.pending {
        background: #fef3c7;
        color: #92400e;
    }
    
    .status-badge.awaiting_payment {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .status-badge.paid {
        background: #d1fae5;
        color: #065f46;
    }
    
    .next-steps {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .next-steps li {
        padding: 8px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #4b5563;
    }
    
    .next-steps li i {
        color: #10b981;
    }
    
    .confirmation-actions {
        display: flex;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
    }
    
    .confirmation-actions .btn {
        flex: 1;
        min-width: 150px;
        padding: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .btn-outline {
        background: white;
        border: 2px solid #e5e7eb;
        color: #4b5563;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-outline:hover {
        background: #f9fafb;
        border-color: #9ca3af;
    }
    
    .confirmation-footer {
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
        text-align: center;
        color: #6b7280;
        font-size: 14px;
    }
    
    .confirmation-footer p {
        margin: 8px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .call-reminder {
        background: #d1ecf1;
        padding: 10px;
        border-radius: 6px;
        color: #0c5460;
        border-left: 3px solid #17a2b8;
        margin-top: 10px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    /* Enhanced Notifications */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 18px 24px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        z-index: 5000;
        animation: slideInRight 0.3s ease;
        max-width: 350px;
        cursor: pointer;
        display: none;
        backdrop-filter: blur(10px);
        border-left: 5px solid;
    }
    
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100%);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .notification.show {
        display: block;
        animation: slideInRight 0.3s ease;
    }
    
    .notification-success {
        background: #f0fdf4;
        color: #065f46;
        border-left-color: #10b981;
    }
    
    .notification-error {
        background: #fef2f2;
        color: #991b1b;
        border-left-color: #ef4444;
    }
    
    .notification-warning {
        background: #fffbeb;
        color: #92400e;
        border-left-color: #f59e0b;
    }
    
    .notification-info {
        background: #eff6ff;
        color: #1e40af;
        border-left-color: #3b82f6;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .cart-content {
            max-width: 100%;
            border-radius: 20px 20px 0 0;
        }
        
        .cart-item {
            flex-direction: column;
            align-items: stretch;
            gap: 15px;
        }
        
        .cart-item-image {
            width: 100%;
            height: 150px;
        }
        
        .cart-item-actions {
            width: 100%;
            flex-direction: row;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .checkout-body {
            flex-direction: column;
        }
        
        .checkout-content {
            max-height: 95vh;
        }
        
        .order-summary,
        .checkout-form {
            flex: none;
            max-height: 50vh;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .checkout-actions {
            flex-direction: column;
        }
        
        .confirmation-actions {
            flex-direction: column;
        }
        
        .confirmation-actions .btn {
            min-width: 100%;
        }
    }
    
    @media (max-width: 480px) {
        .cart-header {
            padding: 15px;
        }
        
        .cart-item {
            padding: 15px;
        }
        
        .cart-total {
            padding: 15px;
        }
        
        .checkout-header {
            padding: 15px 20px;
        }
        
        .order-summary,
        .checkout-form {
            padding: 20px;
        }
        
        .confirmation-header {
            padding: 30px 20px;
        }
        
        .confirmation-body {
            padding: 20px;
        }
        
        .detail-section {
            padding: 15px;
        }
    }
`;

// Inject styles
const styleSheet = document.createElement('style');
styleSheet.textContent = cartStyles;
document.head.appendChild(styleSheet);

// =============== INITIALIZE EVERYTHING ===============
// Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', () => {
    // Initialize cart system
    initCart();
    
    // Setup product card observer
    setupProductCardObserver();
    
    // Update product card buttons initially
    setTimeout(updateProductCardButtons, 500);
    
    // Check for cart updates from other tabs/windows
    window.addEventListener('storage', (e) => {
        if (e.key === 'kindadys_cart') {
            cart = JSON.parse(e.newValue || '[]');
            updateCartCount();
            if (cartModal.style.display === 'flex') {
                renderCartItems();
            }
        }
    });
    
    console.log('Kindady\'s E-tail with WhatsApp notifications initialized successfully!');
});

// =============== PUBLIC API ===============
// Make all cart functions available globally
window.Cart = {
    add: addToCart,
    remove: removeFromCart,
    updateQuantity: updateQuantity,
    clear: clearCart,
    open: openCart,
    close: closeCartModal,
    getItems: getCartItems,
    getTotal: getCartTotal,
    getCount: getCartItemCount,
    proceedToCheckout: proceedToCheckout
};

// For backward compatibility
window.addToCart = addToCart;
window.openCart = openCart;
window.closeCartModal = closeCartModal;
window.removeFromCart = removeFromCart;
window.updateQuantity = updateQuantity;
window.clearCart = clearCart;
window.proceedToCheckout = proceedToCheckout;
// =============== CONTACT FORM FUNCTIONALITY ===============

// Save contact to Firebase
async function saveContactToFirebase(contactData) {
    try {
        const db = window.firestoreDB;
        const contactsCollection = window.firebaseCollection(db, 'contacts');
        
        const docRef = await window.firebaseAddDoc(contactsCollection, {
            ...contactData,
            createdAt: new Date().toISOString(),
            status: 'new',
            read: false,
            archived: false,
            source: 'website_contact_form'
        });
        
        console.log('âœ… Contact saved to Firebase with ID:', docRef.id);
        return { success: true, id: docRef.id, data: contactData };
    } catch (error) {
        console.error('âŒ Error saving contact to Firebase:', error);
        return { success: false, error: error };
    }
}

// Handle contact form submission (SAVES TO FIREBASE ONLY)
async function handleContactSubmit(e) {
    e.preventDefault();
    
    // Get form data
    const name = document.getElementById('name').value;
    const phone = document.getElementById('contactPhone').value;
    const email = document.getElementById('contactEmail').value || '';
    const subject = document.getElementById('contactSubject').value || 'general';
    const message = document.getElementById('message').value;
    
    // Validate phone number
    const phoneRegex = /^0[0-9]{9}$/;
    if (!phoneRegex.test(phone)) {
        showNotification('<i class="fas fa-exclamation-circle"></i> Please enter a valid 10-digit Ghana phone number starting with 0', 'error');
        return;
    }
    
    // Validate required fields
    if (!name.trim() || !message.trim()) {
        showNotification('<i class="fas fa-exclamation-circle"></i> Please fill in all required fields', 'error');
        return;
    }
    
    // Prepare contact data
    const contactData = {
        name: name.trim(),
        phone: phone.trim(),
        email: email.trim(),
        subject: subject,
        message: message.trim(),
        timestamp: new Date().toISOString(),
        status: 'unread',
        ipAddress: await getUserIP(), // Optional: Get user IP for security
        userAgent: navigator.userAgent // Optional: Browser info
    };
    
    // Show loading state
    const submitBtn = document.querySelector('#contactForm button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    submitBtn.disabled = true;
    
    try {
        // Save to Firebase only
        console.log('ðŸ’¾ Saving contact to Firebase...');
        const saveResult = await saveContactToFirebase(contactData);
        
        if (!saveResult.success) {
            throw new Error('Failed to save message');
        }
        
        // Show success message
        showNotification(`
            <i class="fas fa-check-circle"></i> 
            <strong>Message Saved Successfully!</strong><br>
            <small>Miss Dora will review your message and contact you soon</small>
        `, 'success');
        
        // Clear form
        document.getElementById('contactForm').reset();
        
        // Add to recent contacts in localStorage (optional)
        const recentContacts = JSON.parse(localStorage.getItem('kindadys_recent_contacts') || '[]');
        recentContacts.unshift({
            ...contactData,
            id: saveResult.id || Date.now().toString(),
            date: new Date().toLocaleDateString('en-GH')
        });
        
        // Keep only last 20 contacts
        if (recentContacts.length > 20) {
            recentContacts.length = 20;
        }
        
        localStorage.setItem('kindadys_recent_contacts', JSON.stringify(recentContacts));
        
        // Optional: Log success
        console.log('ðŸ“‹ Contact saved:', {
            id: saveResult.id,
            name: contactData.name,
            phone: contactData.phone,
            time: new Date().toLocaleTimeString()
        });
        
    } catch (error) {
        console.error('âŒ Contact form error:', error);
        
        showNotification(`
            <i class="fas fa-exclamation-triangle"></i> 
            <strong>Failed to Save Message</strong><br>
            <small>Please try again or call 0595736002 directly</small>
        `, 'error');
        
    } finally {
        // Restore button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}

// Get user IP address (optional)
async function getUserIP() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    } catch (error) {
        return 'unknown';
    }
}

// Initialize contact form
function initContactForm() {
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
        // Remove any existing event listener first
        contactForm.removeEventListener('submit', handleContactSubmit);
        // Add new event listener
        contactForm.addEventListener('submit', handleContactSubmit);
        console.log('âœ… Contact form initialized (Firebase only)');
    }
}


// =============== UPDATE DOM CONTENT LOADED ===============

// Update your existing DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', () => {
    // ... all your existing initialization code ...
    
    // Add these lines at the end:
    initContactForm();
    addContactFormStyles();
});

// Add CSS for contact form
function addContactFormStyles() {
    const style = document.createElement('style');
    style.textContent = `
        /* Messages Dashboard */
        .messages-dashboard-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .messages-dashboard-content {
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            animation: scaleIn 0.3s ease;
        }
        
        .messages-dashboard-header {
            padding: 20px;
            background: #1a365d;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .messages-dashboard-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .messages-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .messages-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message-card {
            background: white;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .message-card.unread {
            border-left-color: #ed64a6;
            background: #fef6fb;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .message-sender {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .message-phone {
            color: #ed64a6;
            font-weight: 500;
            font-size: 14px;
        }
        
        .message-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .message-time {
            font-size: 12px;
            color: #6b7280;
        }
        
        .message-subject {
            background: #e2e8f0;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #4a5568;
        }
        
        .message-content {
            margin: 15px 0;
            color: #4b5563;
            line-height: 1.5;
        }
        
        .message-actions {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .message-actions button,
        .message-actions a {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        
        .btn-mark-read {
            background: #10b981;
            color: white;
        }
        
        .btn-mark-read:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .btn-reply {
            background: #25D366;
            color: white;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
        }
        
        .messages-dashboard-footer {
            padding: 15px 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .no-messages {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        
        .no-messages i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #d1d5db;
        }
        
        /* Contact form styling */
        .contact-link {
            color: #ed64a6;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .contact-link:hover {
            color: #1a365d;
            text-decoration: underline;
        }
        
        .whatsapp-direct {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 70%;
            margin: 0 auto;
        }
        
        /* Sync button */
        .sync-button {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 6px rgba(255, 154, 158, 0.2);
            white-space: nowrap;
            line-height: 1;
            height: 36px;
        }
    `;
    document.head.appendChild(style);
}

// =============== MAKE FUNCTIONS AVAILABLE GLOBALLY ===============

window.initContactForm = initContactForm;
window.showMessagesDashboard = showMessagesDashboard;
window.closeMessagesDashboard = closeMessagesDashboard;
window.markAsRead = markAsRead;
window.deleteMessage = deleteMessage;
window.refreshMessages = refreshMessages;
</script>

<script type="module" src="script.js"></script>
</body>
</html>